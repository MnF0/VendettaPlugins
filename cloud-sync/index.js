(function(f,de,D,C,B,_,E,s,L,e,y,d,h,k,ge,fe,ye){"use strict";const{TextStyleSheet:he}=d.findByProps("TextStyleSheet"),{View:b,Text:U,Pressable:Se}=y.General,{FormRow:pe}=y.Forms;d.find(function(t){return t.render?.name==="ActionSheet"}),d.findByProps("openLazy","hideActionSheet"),d.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");function Re(t){const n=d.findByProps("colors","meta"),a=d.findByStoreName("ThemeStore");return n.meta.resolveSemanticColor(a.theme,t)}function Ee(t){let{title:n,onPress:a,icon:i}=t;const l=e.stylesheet.createThemedStyleSheet({androidRipple:{color:h.semanticColors.ANDROID_RIPPLE},mainText:{fontFamily:e.constants.Fonts.PRIMARY_SEMIBOLD,fontSize:14,includeFontPadding:!1,letterSpacing:void 0,lineHeight:18,textTransform:"none",color:h.semanticColors.HEADER_SECONDARY},icon:{height:14,tintColor:h.semanticColors.HEADER_SECONDARY}}),r=a?Se:b;return e.React.createElement(r,{android_ripple:l.androidRipple,disabled:!1,accessibilityRole:"button",onPress:a,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},i&&e.React.createElement(b,{style:{marginRight:4}},e.React.createElement(pe.Icon,{style:l.icon,source:i,size:"small"})),e.React.createElement(U,{style:l.mainText},n))}function M(t){let{title:n,onTitlePress:a,icon:i,children:l,padding:r}=t;const u=e.stylesheet.createThemedStyleSheet({main:{backgroundColor:h.semanticColors.BACKGROUND_TERTIARY,borderRadius:16,overflow:"hidden",flex:1}});return e.React.createElement(b,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(Ee,{title:n,onPress:a,icon:i}),e.React.createElement(b,{style:u.main},r?e.React.createElement(b,{style:{paddingHorizontal:16,paddingVertical:16}},l):l))}function Te(t){let{addPadding:n}=t;const a=e.stylesheet.createThemedStyleSheet({line:{width:"100%",height:2,backgroundColor:h.semanticColors.BACKGROUND_ACCENT,borderRadius:2147483647}});return e.React.createElement(b,{style:[{marginTop:16,marginBottom:16},n&&{marginHorizontal:16}]},e.React.createElement(b,{style:a.line}))}var Y;(function(t){function n(i){let{children:l,onPress:r}=i;return e.React.createElement(ve,{variant:"text-md/bold",onPress:r},l)}t.Bold=n;function a(i){let{children:l,onPress:r}=i;return e.React.createElement(U,{style:{textDecorationLine:"underline"},onPress:r},l)}t.Underline=a})(Y||(Y={}));function ve(t){let{variant:n,lineClamp:a,color:i,align:l,style:r,onPress:u,getChildren:g,children:o,liveUpdate:I}=t;const[w,T]=e.React.useReducer(function(R){return~R},0);return e.React.useEffect(function(){if(!I)return;const R=new Date().setMilliseconds(1e3);let v,N;return N=setTimeout(function(){T(),v=setInterval(T,1e3)},R-Date.now()),function(){clearTimeout(N),clearInterval(v)}},[]),e.React.createElement(U,{style:[n?he[n]:{},i?{color:Re(h.semanticColors[i])}:{},l?{textAlign:l}:{},r??{}],numberOfLines:a,onPress:u},g?.()??o)}function K(t){let{onPress:n,icon:a,style:i,destructive:l}=t;const r=e.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:h.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:h.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:h.semanticColors.TEXT_DANGER}});return e.React.createElement(e.ReactNative.TouchableOpacity,{onPress:n},e.React.createElement(e.ReactNative.Image,{style:[typeof i=="string"?i==="header"?r.headerStyleIcon:r.cardStyleIcon:i,l&&r.destructiveIcon].filter(function(u){return!!u}),source:a}))}const{View:Ie,Text:X}=y.General,{TextStyleSheet:J}=d.findByProps("TextStyleSheet"),W=e.stylesheet.createThemedStyleSheet({count:{...J["text-lg/bold"],color:h.semanticColors.TEXT_NORMAL,textAlign:"center"},subtitle:{...J["text-md/medium"],color:h.semanticColors.TEXT_MUTED,textAlign:"center"}});function q(t){let{subtitle:n,count:a,contents:i}=t;return React.createElement(Ie,{style:{alignItems:"center",justifyContent:"center",marginHorizontal:16}},React.createElement(X,{style:W.count},a),React.createElement(X,{style:W.subtitle},n))}const O="https://vd-cloudsync.nexpid.workers.dev/",Z={clientId:"1120793656878714913",redirectURL:`${O}api/oauth2-response`};async function we(t){const n=await fetch(`${O}api/oauth2-response?code=${encodeURIComponent(t)}&vendetta=true`);if(n.status===200)return await n.text();throw(await n.json())?.message}async function Ce(){if(!c.authorization)return;const t=await fetch(`${O}api/get-data`,{headers:{authorization:c.authorization}});if(t.status===200)return await t.json();throw(await t.json())?.message}async function Q(t){if(!c.authorization)return;const n=await fetch(`${O}api/sync-data`,{method:"POST",headers:{authorization:c.authorization,"content-type":"application/json"},body:JSON.stringify(t)});if(n.status===200)return await n.json();throw(await n.json())?.message}async function Ne(){if(!c.authorization)return;const t=await fetch(`${O}api/delete-data`,{method:"DELETE",headers:{authorization:c.authorization}});if(t.status===200)return await t.json();throw(await t.json())?.message}const{pushModal:be,popModal:me}=d.findByProps("pushModal","popModal"),Pe=d.findByName("OAuth2AuthorizeModal");function Ae(){be({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:Pe,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:Z.clientId,redirectUri:Z.redirectURL,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(t){let{location:n}=t;try{const a=new URL(n).searchParams.get("code"),i=await we(a);c.authorization=i,V(),E.showToast("Successfully authenticated",s.getAssetIDByName("Check"))}catch(a){E.showToast(a?.message??a?.toString()??"An error occured during authentication",s.getAssetIDByName("Small"))}},dismissOAuthModal:function(){return me("oauth2-authorize")}},closable:!0}})}const De=window.nativeModuleProxy.BundleUpdaterManager;async function ee(){const t={themes:[],plugins:[]};for(const n of Object.values(B.plugins)){const a=c.pluginSettings[n.id];if(a?.syncPlugin===!1)continue;const i=a?.syncStorage===!1?{}:await D.createMMKVBackend(n.id).get();t.plugins.push({id:n.id,enabled:n.enabled,options:i})}for(const n of Object.values(_.themes))t.themes.push({id:n.id,enabled:n.selected});return t}async function Be(t){if(!p.save)return;let n=!1;const a=p.save.sync.plugins.filter(function(o){return!Object.keys(B.plugins).includes(o.id)&&!o.id.includes("cloud-sync")}),i=a.filter(function(o){return!G(o.id)});let l=!0;i[0]&&await x(!0,"Unproxied Plugins",`Do you want to install **${i.length}** unproxied plugin${i.length!==1?"s":""}? Unproxied plugins haven't been verified by Vendetta staff and thus possibly dangerous. Are you sure you want to continue?`,"Proceed","Skip",void 0,async function(){l=!1});const r=a.filter(function(o){return l?!0:G(o.id)});r.length>0&&await x(t,"Install Plugins",`Would you like to install **${r.length}** new plugin${r.length!==1?"s":""}?`,"Yes","No",async function(){n=!0;for(const o of a)D.createMMKVBackend(o.id).set(o.options),await B.installPlugin(o.id,o.enabled);E.showToast("Synced plugins",s.getAssetIDByName("Check"))});let u;const g=p.save.sync.themes.filter(function(o){return!Object.keys(_.themes).includes(o.id)});g.length>0&&await x(t,"Install Themes",`Would you like to install **${g.length}** new theme${g.length!==1?"s":""}?`,"Yes","No",async function(){n=!0;for(const o of g)o.enabled&&(u=o.id),await _.installTheme(o.id);E.showToast("Synced themes",s.getAssetIDByName("Check"))}),u&&await x(t,"Reload Required","A reload is required to apply the theme. Would you like to reload?","Reload","Skip",async function(){await _.fetchTheme(u,!0),De.reload()}),n||E.showToast("Nothing to sync",s.getAssetIDByName("ic_sync_24px"))}const te=d.findByProps("isTablet"),{Text:_e,View:Oe}=y.General,{FormRow:xe}=y.Forms,{TextStyleSheet:ne}=d.findByProps("TextStyleSheet"),ae=e.stylesheet.createThemedStyleSheet({text:{...ne["text-md/medium"],color:h.semanticColors.TEXT_NORMAL},button:{...ne["text-md/medium"],color:h.semanticColors.TEXT_NORMAL,borderRadius:8}});function $e(){const[t,n]=e.React.useState({});return c.authorization?e.React.createElement(Oe,{style:{flexDirection:te.isTablet?"row":"column",justifyContent:"flex-end"}},[{text:"Sync Data",onPress:async function(a){a(!0);try{p.save=await Q(await ee()),P(),E.showToast("Successfully synced data",s.getAssetIDByName("Check"))}catch(i){E.showToast(`Failed to sync data: ${i}`,s.getAssetIDByName("Small"))}a(!1)}},{text:"Load Data",onPress:async function(a){a(!0);try{await Be(!0)}catch(i){console.log("ZOINKS",i)}a(!1)}}].map(function(a,i){const l=i!==0?8:0;return e.React.createElement(y.Button,{text:a.text,color:"green",size:"small",onPress:function(){return!t[i]&&a.onPress(function(r){n({...t,[i]:!!r})})},trailing:e.React.createElement(xe.Icon,{source:s.getAssetIDByName("Check")}),loading:t[i],style:{...ae.button,...te.isTablet?{marginLeft:l}:{marginTop:l}}})})):e.React.createElement(_e,{style:{...ae.text,textAlign:"center"}},"Authenticate first to manage your data")}const{FormSwitchRow:ie}=y.Forms;function Me(){const[t,n]=e.React.useState(""),[,a]=e.React.useReducer(function(r){return~r},0);e.React.useEffect(function(){n("")},[]),D.useProxy(c);const i=e.NavigationNative.useNavigation(),l=i.addListener("focus",function(){l(),i.setOptions({title:"Plugin Settings",headerRight:function(){return e.React.createElement(K,{onPress:function(){return L.showConfirmationAlert({title:"Revert Settings",content:"Are you sure you want to revert all plugin settings?",confirmText:"Revert",cancelText:"Cancel",confirmColor:"red",onConfirm:function(){return c.pluginSettings={}}})},icon:s.getAssetIDByName("ic_message_delete"),style:"header"})}})});return e.React.createElement(e.ReactNative.FlatList,{ListHeaderComponent:e.React.createElement(y.Search,{style:{marginBottom:10},onChangeText:function(r){return n(r.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:Object.entries(B.plugins).filter(function(r){return r[1].manifest.name?.toLowerCase().includes(t)}),renderItem:function(r){let{item:[u,g]}=r;const o=c.pluginSettings[u]??{syncPlugin:!0,syncStorage:!0},I=function(){o.syncPlugin===!0&&o.syncStorage===!0?delete c.pluginSettings[u]:c.pluginSettings[u]=o,a()};return e.React.createElement(y.Summary,{label:g.manifest.name,icon:g.manifest.vendetta.icon??":3"},e.React.createElement(ie,{label:"Sync Plugin",onValueChange:function(){o.syncPlugin=!o.syncPlugin,I()},value:o.syncPlugin}),e.React.createElement(ie,{label:"Sync Plugin Storage",onValueChange:function(){o.syncStorage=!o.syncStorage,I()},value:o.syncStorage}))}})}var re={github:{url:"https://github.com/Gabe616/VendettaPlugins/"}};const{showSimpleActionSheet:Le}=d.findByProps("showSimpleActionSheet"),ke=d.findByStoreName("UserStore");function Ue(){const t=ye.getDebugInfo(),n=e.ReactNative.NativeModules.InfoDictionaryManager??e.ReactNative.NativeModules.RTNClientInfoManager;return`Device: ${t.os.name==="iOS"?t.device.codename:`${t.device.brand} ${t.device.model}`}
Model: ${t.device.model}
Manufacturer: ${t.device.manufacturer}
Brand: ${t.device.brand}

OS: ${t.os.name}
Version: ${t.os.version}

Discord Branch: ${n.ReleaseChannel}
Discord Version: ${t.discord.version}
Discord Build: ${t.discord.build}
Vendetta Version: ${t.vendetta.version}

React Version: ${t.react.version}
Hermes Bytecode: ${t.hermes.bytecodeVersion}`}function oe(t){const n=ke.getCurrentUser(),a=new URLSearchParams;for(const[i,l]of Object.entries(t))a.set(i,l);return a.set("discord-username",`@${n.username}${n.discriminator!=="0"?`#${n.discriminator}`:""}`),console.log(`${re.github.url}issues/new?${a.toString()}`),`${re.github.url}issues/new?${a.toString()}`}const ze=function(t){return Le({key:"CardOverflow",header:{title:"GitHub Reports"},options:[{label:"Copy bug report link",icon:s.getAssetIDByName("copy"),onPress:function(){e.clipboard.setString(oe({title:`bug(${t}): `,template:"bug_report.yml",labels:"bug",sysinfo:Ue()})),E.showToast("Copied",s.getAssetIDByName("toast_copy_link"))}},{label:"Copy feature suggestion link",icon:s.getAssetIDByName("copy"),onPress:function(){e.clipboard.setString(oe({title:`suggest(${t}): `,labels:"suggestion",template:"suggestion.yml"})),E.showToast("Copied",s.getAssetIDByName("toast_copy_link"))}}]})},{ScrollView:Fe,View:Ve}=y.General,{FormRow:S,FormSwitchRow:ce}=y.Forms;function z(){const[,t]=e.React.useReducer(function(i){return~i},0);D.useProxy(c),f.cacheUpd.push(t),e.React.useEffect(function(){return function(){f.cacheUpd=f.cacheUpd.filter(function(i){return i!==t})}},[]);const n=e.NavigationNative.useNavigation(),a=n.addListener("focus",function(){a(),n.setOptions({headerRight:function(){return e.React.createElement(K,{icon:s.getAssetIDByName("ic_report_message"),style:"header",onPress:function(){return ze("cloud-sync")}})}})});return e.React.createElement(Fe,null,e.React.createElement(M,{title:"Current Data",icon:s.getAssetIDByName("ic_contact_sync"),padding:!0},e.React.createElement(Ve,{style:{flexDirection:"row",alignItems:"center",justifyContent:"center",marginVertical:8}},e.React.createElement(q,{count:p.save?.sync?.plugins?.length??"-",subtitle:"plugins",contents:2}),e.React.createElement(q,{count:p.save?.sync?.themes?.length??"-",subtitle:"themes",contents:2}))),e.React.createElement(M,{title:"Settings",icon:s.getAssetIDByName("ic_cog_24px")},e.React.createElement(ce,{label:"Auto Sync",subLabel:"Automatically sync data to cloud",leading:e.React.createElement(S.Icon,{source:s.getAssetIDByName("ic_contact_sync")}),onValueChange:function(){return c.autoSync=!c.autoSync},value:c.autoSync}),e.React.createElement(ce,{label:"Pin To Settings",subLabel:"Pin Cloud Sync to the settings page",leading:e.React.createElement(S.Icon,{source:s.getAssetIDByName("ic_message_pin")}),onValueChange:function(){return c.addToSettings=!c.addToSettings},value:c.addToSettings}),e.React.createElement(S,{label:"Plugin Settings",leading:e.React.createElement(S.Icon,{source:s.getAssetIDByName("debug")}),trailing:e.React.createElement(S.Arrow,null),onPress:function(){return n.push("VendettaCustomPage",{render:Me})}})),e.React.createElement(M,{title:"Authentication",icon:s.getAssetIDByName("lock")},c.authorization?e.React.createElement(e.React.Fragment,null,e.React.createElement(S,{label:"Log out",subLabel:"Logs you out of CloudSync",leading:e.React.createElement(S.Icon,{source:s.getAssetIDByName("ic_logout_24px")}),onPress:function(){delete c.authorization,delete p.save,P(),E.showToast("Successfully logged out",s.getAssetIDByName("ic_logout_24px"))}}),e.React.createElement(S,{label:"Delete data",subLabel:"Deletes your data and logs you out of CloudSync",leading:e.React.createElement(S.Icon,{source:s.getAssetIDByName("trash")}),onPress:async function(){await Ne(),delete c.authorization,delete p.save,P(),E.showToast("Successfully deleted data",s.getAssetIDByName("trash"))}})):e.React.createElement(S,{label:"Authenticate",leading:e.React.createElement(S.Icon,{source:s.getAssetIDByName("copy")}),trailing:S.Arrow,onPress:Ae})),e.React.createElement(M,{title:"Data Management",icon:s.getAssetIDByName("ic_message_edit"),padding:!0},e.React.createElement($e,null),c.authorization&&e.React.createElement(e.React.Fragment,null,e.React.createElement(Te,null),e.React.createElement(S,{label:"Copy Data as JSON",leading:e.React.createElement(S.Icon,{source:s.getAssetIDByName("copy")}),onPress:function(){e.clipboard.setString(JSON.stringify(p.save??{},void 0,3)),E.showToast("Copied",s.getAssetIDByName("Check"))}}))))}let se=0;function Ge(t){clearTimeout(se),se=setTimeout(t,1500)}const{FormRow:F}=y.Forms;function je(){const t=e.NavigationNative.useNavigation();return React.createElement(y.ErrorBoundary,null,React.createElement(F,{label:"Cloud Sync",leading:React.createElement(F.Icon,{source:s.getAssetIDByName("ic_contact_sync")}),trailing:F.Arrow,onPress:function(){return t.push("VendettaCustomPage",{title:"CloudSync",render:z})}}))}const{FormSection:He}=y.Forms,Ye=d.findByName("getScreens"),Ke=d.findByName("UserSettingsOverviewWrapper",!1),Xe=d.findByName("SettingsOverviewScreen",!1),m=d.findByProps("SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"),Je=d.findByProps("getSettingTitleConfig"),We=e.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:h.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function qe(t,n,a){const i=[],l=C.after("default",Ke,function(r,u){l();const g=k.findInReactTree(u.props.children,function(o){return o.type&&o.type.name==="UserSettingsOverview"});i.push(C.after("render",g.type.prototype,function(o,I){let{props:{children:w}}=I;const T=[e.i18n.Messages.BILLING_SETTINGS,e.i18n.Messages.PREMIUM_SETTINGS];w=k.findInReactTree(w,function(v){return v.children[1].type===He}).children;const R=w.findIndex(function(v){return T.includes(v?.props.label)});t()&&w.splice(R===-1?4:R,0,n())}))},!0);if(i.push(l),Ye&&a){const r=`VENDETTA_PLUGIN_${e.lodash.snakeCase(a.key).toUpperCase()}`;i.push(C.after("default",Xe,function(w,T){const R=T.props.sections,v=R.findIndex(function(N){return N.title==="Vendetta"});if(R[v]&&t()){const N={...R[v]};N.settings=[...N.settings,r],R[v]=N}})),i.push(C.after("getSettingTitleConfig",Je,function(w,T){return{...T,...Object.fromEntries([[r,typeof a.title=="function"?a.title():a.title]])}}));const u=a.page.render,g=e.React.memo(function(w){let{navigation:T}=w;const R=T.addListener("focus",function(){R(),T.setOptions(k.without(a.page,"noErrorBoundary","render"))});return e.React.createElement(e.ReactNative.View,{style:We.container},a.page.noErrorBoundary?e.React.createElement(u,null):e.React.createElement(y.ErrorBoundary,null,e.React.createElement(u,null)))}),o=m.SETTING_RELATIONSHIPS;m.SETTING_RELATIONSHIPS={...o,...Object.fromEntries([[r,null]])};const I=m.SETTING_RENDERER_CONFIGS;m.SETTING_RENDERER_CONFIGS={...I,...Object.fromEntries([[r,{type:"route",icon:a.icon,screen:{route:`VendettaPlugin${e.lodash.chain(a.key).camelCase().upperFirst().value()}`,getComponent:function(){return g}}}]])},i.push(function(){m.SETTING_RELATIONSHIPS=o,m.SETTING_RENDERER_CONFIGS=I})}return function(){return i.forEach(function(r){return r()})}}function Ze(){let t=[];return t.push(qe(function(){return c.addToSettings},function(){return React.createElement(je,null)},{key:ge.plugin.manifest.name,icon:s.getAssetIDByName("ic_contact_sync"),title:"Cloud Sync",page:{title:"CloudSync",render:z}})),function(){return t.forEach(function(n){return n()})}}const c=de.storage,p={};f.cacheUpd=[];function P(){f.cacheUpd.forEach(function(t){return t()})}async function V(){try{p.save=await Ce()}catch{}P()}async function x(t,n,a,i,l,r,u){return t?new Promise(function(g){L.showConfirmationAlert({title:n,content:a,confirmText:i,cancelText:l,confirmColor:"green",isDismissable:!1,onConfirm:function(){return r?r().then(g):g()},onCancel:function(){return u?u().then(g):g()}})}):await r?.()}function G(t){return t.startsWith(fe.PROXY_PREFIX)}const j=async function(){if(!c.autoSync)return;const t=await ee();JSON.stringify(p.save)!==JSON.stringify(t)&&Ge(async function(){p.save=await Q(t),P()})};let A=[],le=!1,H=!1;const ue=function(){A.push(C.after("createMMKVBackend",D,function(t,n){A.push(C.after("set",n,function(){return j()}))}))},$=1;c.autoSync??=!1,c.addToSettings??=!0,c.pluginSettings??={},e.FluxDispatcher.subscribe("I18N_LOAD_SUCCESS",function(){le=!0,H&&ue()});var Qe={onLoad:function(){H=!0,c.authorization&&V(),["installPlugin","startPlugin","stopPlugin","removePlugin"].forEach(function(n){return A.push(C.after(n,B,function(){return j()}))}),["installTheme","selectTheme","removeTheme"].forEach(function(n){return A.push(C.after(n,_,function(){return j()}))}),le&&ue(),A.push(Ze());const t=function(n,a){return L.showConfirmationAlert({title:n,content:a,onConfirm:function(){},confirmText:"Dismiss",confirmColor:"brand",secondaryConfirmText:"Don't show again",onConfirmSecondary:function(){return c.databaseMigrate=$}})};c.databaseMigrate!==$&&window.CSmigrationStage!==$&&(window.CSmigrationStage=$,t("Cloud Sync \u2014 DB Migration Stage 1",`Hey, I'd like to quickly announce that CloudSync will be switching databases soon and your data may get ***deleted***. Make sure to keep an eye on your data for the upcoming weeks!

- nexx`))},onUnload:function(){H=!1,A.forEach(function(t){return t()})},settings:z};return f.cache=p,f.cacheUpdated=P,f.currentMigrationStage=$,f.default=Qe,f.fillCache=V,f.isPluginProxied=G,f.promptOrRun=x,f.vstorage=c,Object.defineProperty(f,"__esModule",{value:!0}),f})({},vendetta.plugin,vendetta.storage,vendetta.patcher,vendetta.plugins,vendetta.themes,vendetta.ui.toasts,vendetta.ui.assets,vendetta.ui.alerts,vendetta.metro.common,vendetta.ui.components,vendetta.metro,vendetta.ui,vendetta.utils,vendetta,vendetta.constants,vendetta.debug);
