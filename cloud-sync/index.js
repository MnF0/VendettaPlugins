(function(g,oe,T,w,C,I,R,s,x,t,y,U,f,ce,p,se){"use strict";const{TextStyleSheet:le}=y.findByProps("TextStyleSheet"),{View:v,Text:_,Pressable:ue}=f.General,{FormRow:de}=f.Forms;y.findByName("ActionSheet"),y.findByProps("openLazy","hideActionSheet"),y.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton");function ge(e){const n=y.findByProps("colors","meta"),a=y.findByStoreName("ThemeStore");return n.meta.resolveSemanticColor(a.theme,e)}function ye(e){let{title:n,onPress:a,icon:i}=e;const l=t.stylesheet.createThemedStyleSheet({androidRipple:{color:p.semanticColors.ANDROID_RIPPLE},mainText:{fontFamily:t.constants.Fonts.PRIMARY_SEMIBOLD,fontSize:14,includeFontPadding:!1,letterSpacing:void 0,lineHeight:18,textTransform:"none",color:p.semanticColors.HEADER_SECONDARY},icon:{height:14,tintColor:p.semanticColors.HEADER_SECONDARY}}),r=a?ue:v;return t.React.createElement(r,{android_ripple:l.androidRipple,disabled:!1,accessibilityRole:"button",onPress:a,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},i&&t.React.createElement(v,{style:{marginRight:4}},t.React.createElement(de.Icon,{style:l.icon,source:i,size:"small"})),t.React.createElement(_,{style:l.mainText},n))}function D(e){let{title:n,onTitlePress:a,icon:i,children:l,padding:r}=e;const d=t.stylesheet.createThemedStyleSheet({main:{backgroundColor:p.semanticColors.BACKGROUND_TERTIARY,borderRadius:16,overflow:"hidden",flex:1}});return t.React.createElement(v,{style:{marginHorizontal:16,marginTop:16}},t.React.createElement(ye,{title:n,onPress:a,icon:i}),t.React.createElement(v,{style:d.main},r?t.React.createElement(v,{style:{paddingHorizontal:16,paddingVertical:16}},l):l))}function fe(e){let{addPadding:n}=e;const a=t.stylesheet.createThemedStyleSheet({line:{width:"100%",height:2,backgroundColor:p.semanticColors.BACKGROUND_ACCENT,borderRadius:2147483647}});return t.React.createElement(v,{style:[{marginTop:16,marginBottom:16},n&&{marginHorizontal:16}]},t.React.createElement(v,{style:a.line}))}var z;(function(e){function n(i){let{children:l,onPress:r}=i;return t.React.createElement(he,{variant:"text-md/bold",onPress:r},l)}e.Bold=n;function a(i){let{children:l,onPress:r}=i;return t.React.createElement(_,{style:{textDecorationLine:"underline"},onPress:r},l)}e.Underline=a})(z||(z={}));function he(e){let{variant:n,lineClamp:a,color:i,align:l,style:r,onPress:d,getChildren:u,children:c,liveUpdate:m}=e;const[B,je]=t.React.useReducer(function(Ge){return~Ge},0),He=new Date().setMilliseconds(1e3);return m&&setTimeout(function(){return je()},He-Date.now()),t.React.createElement(_,{style:[n?le[n]:{},i?{color:ge(p.semanticColors[i])}:{},l?{textAlign:l}:{},r??{}],numberOfLines:a,onPress:d},u?.()??c)}function V(e){let{onPress:n,icon:a,style:i,destructive:l}=e;const r=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:p.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:p.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:p.semanticColors.TEXT_DANGER}});return t.React.createElement(t.ReactNative.TouchableOpacity,{onPress:n},t.React.createElement(t.ReactNative.Image,{style:[typeof i=="string"?i==="header"?r.headerStyleIcon:r.cardStyleIcon:i,l&&r.destructiveIcon].filter(function(d){return!!d}),source:a}))}const{View:pe,Text:F}=f.General,{TextStyleSheet:j}=y.findByProps("TextStyleSheet"),H=t.stylesheet.createThemedStyleSheet({count:{...j["text-lg/bold"],color:p.semanticColors.TEXT_NORMAL,textAlign:"center"},subtitle:{...j["text-md/medium"],color:p.semanticColors.TEXT_MUTED,textAlign:"center"}});function G(e){let{subtitle:n,count:a,contents:i}=e;return React.createElement(pe,{style:{alignItems:"center",justifyContent:"center",marginHorizontal:16}},React.createElement(F,{style:H.count},a),React.createElement(F,{style:H.subtitle},n))}const P="https://vd-cloudsync.nexpid.workers.dev/",Y={clientId:"1120793656878714913",redirectURL:`${P}api/oauth2-response`};async function Se(e){const n=await fetch(`${P}api/oauth2-response?code=${encodeURIComponent(e)}&vendetta=true`);if(n.status===200)return await n.text();throw(await n.json())?.message}async function Re(){if(!o.authorization)return;const e=await fetch(`${P}api/get-data`,{headers:{authorization:o.authorization}});if(e.status===200)return await e.json();throw(await e.json())?.message}async function X(e){if(!o.authorization)return;const n=await fetch(`${P}api/sync-data`,{method:"POST",headers:{authorization:o.authorization,"content-type":"application/json"},body:JSON.stringify(e)});if(n.status===200)return await n.json();throw(await n.json())?.message}async function ve(){if(!o.authorization)return;const e=await fetch(`${P}api/delete-data`,{method:"DELETE",headers:{authorization:o.authorization}});if(e.status===200)return await e.json();throw(await e.json())?.message}const{pushModal:me,popModal:we}=y.findByProps("pushModal","popModal"),Ee=y.findByName("OAuth2AuthorizeModal");function be(){me({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:Ee,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:Y.clientId,redirectUri:Y.redirectURL,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(e){let{location:n}=e;try{const a=new URL(n).searchParams.get("code"),i=await Se(a);o.authorization=i,M(),R.showToast("Successfully authenticated",s.getAssetIDByName("Check"))}catch(a){R.showToast(a?.message??a?.toString()??"An error occured during authentication",s.getAssetIDByName("Small"))}},dismissOAuthModal:function(){return we("oauth2-authorize")}},closable:!0}})}const Te=window.nativeModuleProxy.BundleUpdaterManager;async function K(){const e={themes:[],plugins:[]};for(const n of Object.values(C.plugins)){const a=o.pluginSettings[n.id];if(a?.syncPlugin===!1)continue;const i=a?.syncStorage===!1?{}:await T.createMMKVBackend(n.id).get();e.plugins.push({id:n.id,enabled:n.enabled,options:i})}for(const n of Object.values(I.themes))e.themes.push({id:n.id,enabled:n.selected});return e}async function Ce(e){if(!S.save)return;let n=!1;const a=S.save.sync.plugins.filter(function(c){return!Object.keys(C.plugins).includes(c.id)&&!c.id.includes("cloud-sync")}),i=a.filter(function(c){return!O(c.id)});let l=!0;i[0]&&await A(!0,"Unproxied Plugins",`Do you want to install **${i.length}** unproxied plugin${i.length!==1?"s":""}? Unproxied plugins haven't been verified by Vendetta staff and thus possibly dangerous. Are you sure you want to continue?`,"Proceed","Skip",void 0,async function(){l=!1});const r=a.filter(function(c){return l?!0:O(c.id)});r.length>0&&await A(e,"Install Plugins",`Would you like to install **${r.length}** new plugin${r.length!==1?"s":""}?`,"Yes","No",async function(){n=!0;for(const c of a)T.createMMKVBackend(c.id).set(c.options),await C.installPlugin(c.id,c.enabled);R.showToast("Synced plugins",s.getAssetIDByName("Check"))});let d;const u=S.save.sync.themes.filter(function(c){return!Object.keys(I.themes).includes(c.id)});u.length>0&&await A(e,"Install Themes",`Would you like to install **${u.length}** new theme${u.length!==1?"s":""}?`,"Yes","No",async function(){n=!0;for(const c of u)c.enabled&&(d=c.id),await I.installTheme(c.id);R.showToast("Synced themes",s.getAssetIDByName("Check"))}),d&&await A(e,"Reload Required","A reload is required to apply the theme. Would you like to reload?","Reload","Skip",async function(){await I.fetchTheme(d,!0),Te.reload()}),n||R.showToast("Nothing to sync",s.getAssetIDByName("ic_sync_24px"))}const J=y.findByProps("isTablet"),{Text:Ie,View:Pe}=f.General,{FormRow:Ae}=f.Forms,{TextStyleSheet:W}=y.findByProps("TextStyleSheet"),q=t.stylesheet.createThemedStyleSheet({text:{...W["text-md/medium"],color:p.semanticColors.TEXT_NORMAL},button:{...W["text-md/medium"],color:p.semanticColors.TEXT_NORMAL,borderRadius:8}});function Ne(){const[e,n]=t.React.useState({});return o.authorization?t.React.createElement(Pe,{style:{flexDirection:J.isTablet?"row":"column",justifyContent:"flex-end"}},[{text:"Sync Data",onPress:async function(a){a(!0);try{S.save=await X(await K()),E(),R.showToast("Successfully synced data",s.getAssetIDByName("Check"))}catch(i){R.showToast(`Failed to sync data: ${i}`,s.getAssetIDByName("Small"))}a(!1)}},{text:"Load Data",onPress:async function(a){a(!0);try{await Ce(!0)}catch(i){console.log("ZOINKS",i)}a(!1)}}].map(function(a,i){const l=i!==0?8:0;return t.React.createElement(f.Button,{text:a.text,color:"green",size:"small",onPress:function(){return!e[i]&&a.onPress(function(r){n({...e,[i]:!!r})})},trailing:t.React.createElement(Ae.Icon,{source:s.getAssetIDByName("Check")}),loading:e[i],style:{...q.button,...J.isTablet?{marginLeft:l}:{marginTop:l}}})})):t.React.createElement(Ie,{style:{...q.text,textAlign:"center"}},"Authenticate first to manage your data")}const{FormSwitchRow:Z}=f.Forms;function De(){const[e,n]=t.React.useState(""),[,a]=t.React.useReducer(function(r){return~r},0);t.React.useEffect(function(){n("")},[]),T.useProxy(o);const i=t.NavigationNative.useNavigation(),l=i.addListener("focus",function(){l(),i.setOptions({title:"Plugin Settings",headerRight:function(){return t.React.createElement(V,{onPress:function(){return x.showConfirmationAlert({title:"Revert Settings",content:"Are you sure you want to revert all plugin settings?",confirmText:"Revert",cancelText:"Cancel",confirmColor:"red",onConfirm:function(){return o.pluginSettings={}}})},icon:s.getAssetIDByName("ic_message_delete"),style:"header"})}})});return t.React.createElement(t.ReactNative.FlatList,{ListHeaderComponent:t.React.createElement(f.Search,{style:{marginBottom:10},onChangeText:function(r){return n(r.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:Object.entries(C.plugins).filter(function(r){return r[1].manifest.name?.toLowerCase().includes(e)}),renderItem:function(r){let{item:[d,u]}=r;const c=o.pluginSettings[d]??{syncPlugin:!0,syncStorage:!0},m=function(){c.syncPlugin===!0&&c.syncStorage===!0?delete o.pluginSettings[d]:o.pluginSettings[d]=c,a()};return t.React.createElement(f.Summary,{label:u.manifest.name,icon:u.manifest.vendetta.icon??":3"},t.React.createElement(Z,{label:"Sync Plugin",onValueChange:function(){c.syncPlugin=!c.syncPlugin,m()},value:c.syncPlugin}),t.React.createElement(Z,{label:"Sync Plugin Storage",onValueChange:function(){c.syncStorage=!c.syncStorage,m()},value:c.syncStorage}))}})}var Q={github:{url:"https://github.com/Gabe616/VendettaPlugins/"}};const{showSimpleActionSheet:Be}=y.findByProps("showSimpleActionSheet"),xe=y.findByStoreName("UserStore");function _e(){const e=se.getDebugInfo(),n=t.ReactNative.NativeModules.InfoDictionaryManager??t.ReactNative.NativeModules.RTNClientInfoManager;return`Device: ${e.os.name==="iOS"?e.device.codename:`${e.device.brand} ${e.device.model}`}
Model: ${e.device.model}
Manufacturer: ${e.device.manufacturer}
Brand: ${e.device.brand}

OS: ${e.os.name}
Version: ${e.os.version}

Discord Branch: ${n.ReleaseChannel}
Discord Version: ${e.discord.version}
Discord Build: ${e.discord.build}
Vendetta Version: ${e.vendetta.version}

React Version: ${e.react.version}
Hermes Bytecode: ${e.hermes.bytecodeVersion}`}function ee(e){const n=xe.getCurrentUser(),a=new URLSearchParams;for(const[i,l]of Object.entries(e))a.set(i,l);return a.set("discord-username",`@${n.username}${n.discriminator!=="0"?`#${n.discriminator}`:""}`),console.log(`${Q.github.url}issues/new?${a.toString()}`),`${Q.github.url}issues/new?${a.toString()}`}const $e=function(e){return Be({key:"CardOverflow",header:{title:"GitHub Reports"},options:[{label:"Copy bug report link",icon:s.getAssetIDByName("copy"),onPress:function(){t.clipboard.setString(ee({title:`bug(${e}): `,template:"bug_report.yml",labels:"bug",sysinfo:_e()})),R.showToast("Copied",s.getAssetIDByName("toast_copy_link"))}},{label:"Copy feature suggestion link",icon:s.getAssetIDByName("copy"),onPress:function(){t.clipboard.setString(ee({title:`suggest(${e}): `,labels:"suggestion",template:"suggestion.yml"})),R.showToast("Copied",s.getAssetIDByName("toast_copy_link"))}}]})},{ScrollView:Me,View:Oe}=f.General,{FormRow:h,FormSwitchRow:te}=f.Forms;function ne(){const[,e]=t.React.useReducer(function(i){return~i},0);T.useProxy(o),g.cacheUpd.push(e),t.React.useEffect(function(){return function(){g.cacheUpd=g.cacheUpd.filter(function(i){return i!==e})}},[]);const n=t.NavigationNative.useNavigation(),a=n.addListener("focus",function(){a(),n.setOptions({title:"CloudSync",headerRight:function(){return t.React.createElement(V,{icon:s.getAssetIDByName("ic_report_message"),style:"header",onPress:function(){return $e("cloud-sync")}})}})});return t.React.createElement(Me,null,t.React.createElement(D,{title:"Current Data",icon:s.getAssetIDByName("ic_contact_sync"),padding:!0},t.React.createElement(Oe,{style:{flexDirection:"row",alignItems:"center",justifyContent:"center",marginVertical:8}},t.React.createElement(G,{count:S.save?.sync?.plugins?.length??"-",subtitle:"plugins",contents:2}),t.React.createElement(G,{count:S.save?.sync?.themes?.length??"-",subtitle:"themes",contents:2}))),t.React.createElement(D,{title:"Settings",icon:s.getAssetIDByName("ic_cog_24px")},t.React.createElement(te,{label:"Auto Sync",subLabel:"Automatically sync data to cloud",leading:t.React.createElement(h.Icon,{source:s.getAssetIDByName("ic_contact_sync")}),onValueChange:function(){return o.autoSync=!o.autoSync},value:o.autoSync}),t.React.createElement(te,{label:"Pin To Settings",subLabel:"Pin Cloud Sync to the settings page",leading:t.React.createElement(h.Icon,{source:s.getAssetIDByName("ic_message_pin")}),onValueChange:function(){return o.addToSettings=!o.addToSettings},value:o.addToSettings}),t.React.createElement(h,{label:"Plugin Settings",leading:t.React.createElement(h.Icon,{source:s.getAssetIDByName("debug")}),trailing:t.React.createElement(h.Arrow,null),onPress:function(){return n.push("VendettaCustomPage",{render:De})}})),t.React.createElement(D,{title:"Authentication",icon:s.getAssetIDByName("lock")},o.authorization?t.React.createElement(t.React.Fragment,null,t.React.createElement(h,{label:"Log out",subLabel:"Logs you out of CloudSync",leading:t.React.createElement(h.Icon,{source:s.getAssetIDByName("ic_logout_24px")}),onPress:function(){delete o.authorization,delete S.save,E(),R.showToast("Successfully logged out",s.getAssetIDByName("ic_logout_24px"))}}),t.React.createElement(h,{label:"Delete data",subLabel:"Deletes your data and logs you out of CloudSync",leading:t.React.createElement(h.Icon,{source:s.getAssetIDByName("trash")}),onPress:async function(){await ve(),delete o.authorization,delete S.save,E(),R.showToast("Successfully deleted data",s.getAssetIDByName("trash"))}})):t.React.createElement(h,{label:"Authenticate",leading:t.React.createElement(h.Icon,{source:s.getAssetIDByName("copy")}),trailing:h.Arrow,onPress:be})),t.React.createElement(D,{title:"Data Management",icon:s.getAssetIDByName("ic_message_edit"),padding:!0},t.React.createElement(Ne,null),o.authorization&&t.React.createElement(t.React.Fragment,null,t.React.createElement(fe,null),t.React.createElement(h,{label:"Copy Data as JSON",leading:t.React.createElement(h.Icon,{source:s.getAssetIDByName("copy")}),onPress:function(){t.clipboard.setString(JSON.stringify(S.save??{},void 0,3)),R.showToast("Copied",s.getAssetIDByName("Check"))}}))))}let ae=0;function Le(e){clearTimeout(ae),ae=setTimeout(e,1500)}const{FormRow:$}=f.Forms;function ke(){const e=t.NavigationNative.useNavigation();return React.createElement(f.ErrorBoundary,null,React.createElement($,{label:"Cloud Sync",leading:React.createElement($.Icon,{source:s.getAssetIDByName("ic_contact_sync")}),trailing:$.Arrow,onPress:function(){return e.push("VendettaCustomPage",{render:ne})}}))}const{FormSection:Ue}=f.Forms,ze=y.findByName("UserSettingsOverviewWrapper",!1);function Ve(){let e=[],n=w.after("default",ze,function(a,i){n();const l=U.findInReactTree(i.props.children,function(r){return r.type&&r.type.name==="UserSettingsOverview"});e.push(w.after("render",l.type.prototype,function(r,d){let{props:{children:u}}=d;if(!o.addToSettings)return;const c=[t.i18n.Messages.BILLING_SETTINGS,t.i18n.Messages.PREMIUM_SETTINGS];u=U.findInReactTree(u,function(B){return B.children[1].type===Ue}).children;const m=u.findIndex(function(B){return c.includes(B?.props.label)});u.splice(m===-1?4:m,0,React.createElement(ke,null))}))},!0);return function(){return e.forEach(function(a){return a()})}}const o=oe.storage,S={};g.cacheUpd=[];function E(){g.cacheUpd.forEach(function(e){return e()})}async function M(){try{S.save=await Re()}catch{}E()}async function A(e,n,a,i,l,r,d){return e?new Promise(function(u){x.showConfirmationAlert({title:n,content:a,confirmText:i,cancelText:l,confirmColor:"green",isDismissable:!1,onConfirm:function(){return r?r().then(u):u()},onCancel:function(){return d?d().then(u):u()}})}):await r?.()}function O(e){return e.startsWith(ce.PROXY_PREFIX)}const L=async function(){if(!o.autoSync)return;const e=await K();JSON.stringify(S.save)!==JSON.stringify(e)&&Le(async function(){S.save=await X(e),E()})};let b=[],ie=!1,k=!1;const re=function(){b.push(w.after("createMMKVBackend",T,function(e,n){b.push(w.after("set",n,function(){return L()}))}))},N=1;o.autoSync??=!1,o.addToSettings??=!0,o.pluginSettings??={},t.FluxDispatcher.subscribe("I18N_LOAD_SUCCESS",function(){ie=!0,k&&re()});var Fe={onLoad:function(){k=!0,o.authorization&&M(),["installPlugin","startPlugin","stopPlugin","removePlugin"].forEach(function(n){return b.push(w.after(n,C,function(){return L()}))}),["installTheme","selectTheme","removeTheme"].forEach(function(n){return b.push(w.after(n,I,function(){return L()}))}),ie&&re(),b.push(Ve());const e=function(n,a){return x.showConfirmationAlert({title:n,content:a,onConfirm:function(){},confirmText:"Dismiss",confirmColor:"brand",secondaryConfirmText:"Don't show again",onConfirmSecondary:function(){return o.databaseMigrate=N}})};o.databaseMigrate!==N&&window.CSmigrationStage!==N&&(window.CSmigrationStage=N,e("Cloud Sync \u2014 DB Migration Stage 1",`Hey, I'd like to quickly announce that CloudSync will be switching databases soon and your data may get ***deleted***. Make sure to keep an eye on your data for the upcoming weeks!

- nexx`))},onUnload:function(){k=!1,b.forEach(function(e){return e()})},settings:ne};return g.cache=S,g.cacheUpdated=E,g.currentMigrationStage=N,g.default=Fe,g.fillCache=M,g.isPluginProxied=O,g.promptOrRun=A,g.vstorage=o,Object.defineProperty(g,"__esModule",{value:!0}),g})({},vendetta.plugin,vendetta.storage,vendetta.patcher,vendetta.plugins,vendetta.themes,vendetta.ui.toasts,vendetta.ui.assets,vendetta.ui.alerts,vendetta.metro.common,vendetta.metro,vendetta.utils,vendetta.ui.components,vendetta.constants,vendetta.ui,vendetta.debug);
