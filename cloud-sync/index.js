(function(f,de,A,w,D,B,R,c,L,e,y,g,h,k,ge,fe,ye){"use strict";const{TextStyleSheet:he}=g.findByProps("TextStyleSheet"),{View:N,Text:U,Pressable:Se}=y.General,{FormRow:pe}=y.Forms;g.findByName("ActionSheet"),g.findByProps("openLazy","hideActionSheet"),g.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton");function Re(t){const n=g.findByProps("colors","meta"),a=g.findByStoreName("ThemeStore");return n.meta.resolveSemanticColor(a.theme,t)}function Ee(t){let{title:n,onPress:a,icon:i}=t;const l=e.stylesheet.createThemedStyleSheet({androidRipple:{color:h.semanticColors.ANDROID_RIPPLE},mainText:{fontFamily:e.constants.Fonts.PRIMARY_SEMIBOLD,fontSize:14,includeFontPadding:!1,letterSpacing:void 0,lineHeight:18,textTransform:"none",color:h.semanticColors.HEADER_SECONDARY},icon:{height:14,tintColor:h.semanticColors.HEADER_SECONDARY}}),r=a?Se:N;return e.React.createElement(r,{android_ripple:l.androidRipple,disabled:!1,accessibilityRole:"button",onPress:a,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},i&&e.React.createElement(N,{style:{marginRight:4}},e.React.createElement(pe.Icon,{style:l.icon,source:i,size:"small"})),e.React.createElement(U,{style:l.mainText},n))}function $(t){let{title:n,onTitlePress:a,icon:i,children:l,padding:r}=t;const d=e.stylesheet.createThemedStyleSheet({main:{backgroundColor:h.semanticColors.BACKGROUND_TERTIARY,borderRadius:16,overflow:"hidden",flex:1}});return e.React.createElement(N,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(Ee,{title:n,onPress:a,icon:i}),e.React.createElement(N,{style:d.main},r?e.React.createElement(N,{style:{paddingHorizontal:16,paddingVertical:16}},l):l))}function Te(t){let{addPadding:n}=t;const a=e.stylesheet.createThemedStyleSheet({line:{width:"100%",height:2,backgroundColor:h.semanticColors.BACKGROUND_ACCENT,borderRadius:2147483647}});return e.React.createElement(N,{style:[{marginTop:16,marginBottom:16},n&&{marginHorizontal:16}]},e.React.createElement(N,{style:a.line}))}var Y;(function(t){function n(i){let{children:l,onPress:r}=i;return e.React.createElement(Ce,{variant:"text-md/bold",onPress:r},l)}t.Bold=n;function a(i){let{children:l,onPress:r}=i;return e.React.createElement(U,{style:{textDecorationLine:"underline"},onPress:r},l)}t.Underline=a})(Y||(Y={}));function Ce(t){let{variant:n,lineClamp:a,color:i,align:l,style:r,onPress:d,getChildren:u,children:o,liveUpdate:C}=t;const[I,T]=e.React.useReducer(function(v){return~v},0),E=new Date().setMilliseconds(1e3);return C&&setTimeout(function(){return T()},E-Date.now()),e.React.createElement(U,{style:[n?he[n]:{},i?{color:Re(h.semanticColors[i])}:{},l?{textAlign:l}:{},r??{}],numberOfLines:a,onPress:d},u?.()??o)}function K(t){let{onPress:n,icon:a,style:i,destructive:l}=t;const r=e.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:h.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:h.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:h.semanticColors.TEXT_DANGER}});return e.React.createElement(e.ReactNative.TouchableOpacity,{onPress:n},e.React.createElement(e.ReactNative.Image,{style:[typeof i=="string"?i==="header"?r.headerStyleIcon:r.cardStyleIcon:i,l&&r.destructiveIcon].filter(function(d){return!!d}),source:a}))}const{View:Ie,Text:X}=y.General,{TextStyleSheet:J}=g.findByProps("TextStyleSheet"),W=e.stylesheet.createThemedStyleSheet({count:{...J["text-lg/bold"],color:h.semanticColors.TEXT_NORMAL,textAlign:"center"},subtitle:{...J["text-md/medium"],color:h.semanticColors.TEXT_MUTED,textAlign:"center"}});function q(t){let{subtitle:n,count:a,contents:i}=t;return React.createElement(Ie,{style:{alignItems:"center",justifyContent:"center",marginHorizontal:16}},React.createElement(X,{style:W.count},a),React.createElement(X,{style:W.subtitle},n))}const _="https://vd-cloudsync.nexpid.workers.dev/",Z={clientId:"1120793656878714913",redirectURL:`${_}api/oauth2-response`};async function ve(t){const n=await fetch(`${_}api/oauth2-response?code=${encodeURIComponent(t)}&vendetta=true`);if(n.status===200)return await n.text();throw(await n.json())?.message}async function we(){if(!s.authorization)return;const t=await fetch(`${_}api/get-data`,{headers:{authorization:s.authorization}});if(t.status===200)return await t.json();throw(await t.json())?.message}async function Q(t){if(!s.authorization)return;const n=await fetch(`${_}api/sync-data`,{method:"POST",headers:{authorization:s.authorization,"content-type":"application/json"},body:JSON.stringify(t)});if(n.status===200)return await n.json();throw(await n.json())?.message}async function Ne(){if(!s.authorization)return;const t=await fetch(`${_}api/delete-data`,{method:"DELETE",headers:{authorization:s.authorization}});if(t.status===200)return await t.json();throw(await t.json())?.message}const{pushModal:be,popModal:me}=g.findByProps("pushModal","popModal"),Pe=g.findByName("OAuth2AuthorizeModal");function Ae(){be({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:Pe,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:Z.clientId,redirectUri:Z.redirectURL,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(t){let{location:n}=t;try{const a=new URL(n).searchParams.get("code"),i=await ve(a);s.authorization=i,V(),R.showToast("Successfully authenticated",c.getAssetIDByName("Check"))}catch(a){R.showToast(a?.message??a?.toString()??"An error occured during authentication",c.getAssetIDByName("Small"))}},dismissOAuthModal:function(){return me("oauth2-authorize")}},closable:!0}})}const De=window.nativeModuleProxy.BundleUpdaterManager;async function ee(){const t={themes:[],plugins:[]};for(const n of Object.values(D.plugins)){const a=s.pluginSettings[n.id];if(a?.syncPlugin===!1)continue;const i=a?.syncStorage===!1?{}:await A.createMMKVBackend(n.id).get();t.plugins.push({id:n.id,enabled:n.enabled,options:i})}for(const n of Object.values(B.themes))t.themes.push({id:n.id,enabled:n.selected});return t}async function Be(t){if(!p.save)return;let n=!1;const a=p.save.sync.plugins.filter(function(o){return!Object.keys(D.plugins).includes(o.id)&&!o.id.includes("cloud-sync")}),i=a.filter(function(o){return!G(o.id)});let l=!0;i[0]&&await O(!0,"Unproxied Plugins",`Do you want to install **${i.length}** unproxied plugin${i.length!==1?"s":""}? Unproxied plugins haven't been verified by Vendetta staff and thus possibly dangerous. Are you sure you want to continue?`,"Proceed","Skip",void 0,async function(){l=!1});const r=a.filter(function(o){return l?!0:G(o.id)});r.length>0&&await O(t,"Install Plugins",`Would you like to install **${r.length}** new plugin${r.length!==1?"s":""}?`,"Yes","No",async function(){n=!0;for(const o of a)A.createMMKVBackend(o.id).set(o.options),await D.installPlugin(o.id,o.enabled);R.showToast("Synced plugins",c.getAssetIDByName("Check"))});let d;const u=p.save.sync.themes.filter(function(o){return!Object.keys(B.themes).includes(o.id)});u.length>0&&await O(t,"Install Themes",`Would you like to install **${u.length}** new theme${u.length!==1?"s":""}?`,"Yes","No",async function(){n=!0;for(const o of u)o.enabled&&(d=o.id),await B.installTheme(o.id);R.showToast("Synced themes",c.getAssetIDByName("Check"))}),d&&await O(t,"Reload Required","A reload is required to apply the theme. Would you like to reload?","Reload","Skip",async function(){await B.fetchTheme(d,!0),De.reload()}),n||R.showToast("Nothing to sync",c.getAssetIDByName("ic_sync_24px"))}const te=g.findByProps("isTablet"),{Text:_e,View:Oe}=y.General,{FormRow:xe}=y.Forms,{TextStyleSheet:ne}=g.findByProps("TextStyleSheet"),ae=e.stylesheet.createThemedStyleSheet({text:{...ne["text-md/medium"],color:h.semanticColors.TEXT_NORMAL},button:{...ne["text-md/medium"],color:h.semanticColors.TEXT_NORMAL,borderRadius:8}});function Me(){const[t,n]=e.React.useState({});return s.authorization?e.React.createElement(Oe,{style:{flexDirection:te.isTablet?"row":"column",justifyContent:"flex-end"}},[{text:"Sync Data",onPress:async function(a){a(!0);try{p.save=await Q(await ee()),m(),R.showToast("Successfully synced data",c.getAssetIDByName("Check"))}catch(i){R.showToast(`Failed to sync data: ${i}`,c.getAssetIDByName("Small"))}a(!1)}},{text:"Load Data",onPress:async function(a){a(!0);try{await Be(!0)}catch(i){console.log("ZOINKS",i)}a(!1)}}].map(function(a,i){const l=i!==0?8:0;return e.React.createElement(y.Button,{text:a.text,color:"green",size:"small",onPress:function(){return!t[i]&&a.onPress(function(r){n({...t,[i]:!!r})})},trailing:e.React.createElement(xe.Icon,{source:c.getAssetIDByName("Check")}),loading:t[i],style:{...ae.button,...te.isTablet?{marginLeft:l}:{marginTop:l}}})})):e.React.createElement(_e,{style:{...ae.text,textAlign:"center"}},"Authenticate first to manage your data")}const{FormSwitchRow:ie}=y.Forms;function $e(){const[t,n]=e.React.useState(""),[,a]=e.React.useReducer(function(r){return~r},0);e.React.useEffect(function(){n("")},[]),A.useProxy(s);const i=e.NavigationNative.useNavigation(),l=i.addListener("focus",function(){l(),i.setOptions({title:"Plugin Settings",headerRight:function(){return e.React.createElement(K,{onPress:function(){return L.showConfirmationAlert({title:"Revert Settings",content:"Are you sure you want to revert all plugin settings?",confirmText:"Revert",cancelText:"Cancel",confirmColor:"red",onConfirm:function(){return s.pluginSettings={}}})},icon:c.getAssetIDByName("ic_message_delete"),style:"header"})}})});return e.React.createElement(e.ReactNative.FlatList,{ListHeaderComponent:e.React.createElement(y.Search,{style:{marginBottom:10},onChangeText:function(r){return n(r.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:Object.entries(D.plugins).filter(function(r){return r[1].manifest.name?.toLowerCase().includes(t)}),renderItem:function(r){let{item:[d,u]}=r;const o=s.pluginSettings[d]??{syncPlugin:!0,syncStorage:!0},C=function(){o.syncPlugin===!0&&o.syncStorage===!0?delete s.pluginSettings[d]:s.pluginSettings[d]=o,a()};return e.React.createElement(y.Summary,{label:u.manifest.name,icon:u.manifest.vendetta.icon??":3"},e.React.createElement(ie,{label:"Sync Plugin",onValueChange:function(){o.syncPlugin=!o.syncPlugin,C()},value:o.syncPlugin}),e.React.createElement(ie,{label:"Sync Plugin Storage",onValueChange:function(){o.syncStorage=!o.syncStorage,C()},value:o.syncStorage}))}})}var re={github:{url:"https://github.com/Gabe616/VendettaPlugins/"}};const{showSimpleActionSheet:Le}=g.findByProps("showSimpleActionSheet"),ke=g.findByStoreName("UserStore");function Ue(){const t=ye.getDebugInfo(),n=e.ReactNative.NativeModules.InfoDictionaryManager??e.ReactNative.NativeModules.RTNClientInfoManager;return`Device: ${t.os.name==="iOS"?t.device.codename:`${t.device.brand} ${t.device.model}`}
Model: ${t.device.model}
Manufacturer: ${t.device.manufacturer}
Brand: ${t.device.brand}

OS: ${t.os.name}
Version: ${t.os.version}

Discord Branch: ${n.ReleaseChannel}
Discord Version: ${t.discord.version}
Discord Build: ${t.discord.build}
Vendetta Version: ${t.vendetta.version}

React Version: ${t.react.version}
Hermes Bytecode: ${t.hermes.bytecodeVersion}`}function oe(t){const n=ke.getCurrentUser(),a=new URLSearchParams;for(const[i,l]of Object.entries(t))a.set(i,l);return a.set("discord-username",`@${n.username}${n.discriminator!=="0"?`#${n.discriminator}`:""}`),console.log(`${re.github.url}issues/new?${a.toString()}`),`${re.github.url}issues/new?${a.toString()}`}const ze=function(t){return Le({key:"CardOverflow",header:{title:"GitHub Reports"},options:[{label:"Copy bug report link",icon:c.getAssetIDByName("copy"),onPress:function(){e.clipboard.setString(oe({title:`bug(${t}): `,template:"bug_report.yml",labels:"bug",sysinfo:Ue()})),R.showToast("Copied",c.getAssetIDByName("toast_copy_link"))}},{label:"Copy feature suggestion link",icon:c.getAssetIDByName("copy"),onPress:function(){e.clipboard.setString(oe({title:`suggest(${t}): `,labels:"suggestion",template:"suggestion.yml"})),R.showToast("Copied",c.getAssetIDByName("toast_copy_link"))}}]})},{ScrollView:Fe,View:Ve}=y.General,{FormRow:S,FormSwitchRow:se}=y.Forms;function z(){const[,t]=e.React.useReducer(function(i){return~i},0);A.useProxy(s),f.cacheUpd.push(t),e.React.useEffect(function(){return function(){f.cacheUpd=f.cacheUpd.filter(function(i){return i!==t})}},[]);const n=e.NavigationNative.useNavigation(),a=n.addListener("focus",function(){a(),n.setOptions({headerRight:function(){return e.React.createElement(K,{icon:c.getAssetIDByName("ic_report_message"),style:"header",onPress:function(){return ze("cloud-sync")}})}})});return e.React.createElement(Fe,null,e.React.createElement($,{title:"Current Data",icon:c.getAssetIDByName("ic_contact_sync"),padding:!0},e.React.createElement(Ve,{style:{flexDirection:"row",alignItems:"center",justifyContent:"center",marginVertical:8}},e.React.createElement(q,{count:p.save?.sync?.plugins?.length??"-",subtitle:"plugins",contents:2}),e.React.createElement(q,{count:p.save?.sync?.themes?.length??"-",subtitle:"themes",contents:2}))),e.React.createElement($,{title:"Settings",icon:c.getAssetIDByName("ic_cog_24px")},e.React.createElement(se,{label:"Auto Sync",subLabel:"Automatically sync data to cloud",leading:e.React.createElement(S.Icon,{source:c.getAssetIDByName("ic_contact_sync")}),onValueChange:function(){return s.autoSync=!s.autoSync},value:s.autoSync}),e.React.createElement(se,{label:"Pin To Settings",subLabel:"Pin Cloud Sync to the settings page",leading:e.React.createElement(S.Icon,{source:c.getAssetIDByName("ic_message_pin")}),onValueChange:function(){return s.addToSettings=!s.addToSettings},value:s.addToSettings}),e.React.createElement(S,{label:"Plugin Settings",leading:e.React.createElement(S.Icon,{source:c.getAssetIDByName("debug")}),trailing:e.React.createElement(S.Arrow,null),onPress:function(){return n.push("VendettaCustomPage",{render:$e})}})),e.React.createElement($,{title:"Authentication",icon:c.getAssetIDByName("lock")},s.authorization?e.React.createElement(e.React.Fragment,null,e.React.createElement(S,{label:"Log out",subLabel:"Logs you out of CloudSync",leading:e.React.createElement(S.Icon,{source:c.getAssetIDByName("ic_logout_24px")}),onPress:function(){delete s.authorization,delete p.save,m(),R.showToast("Successfully logged out",c.getAssetIDByName("ic_logout_24px"))}}),e.React.createElement(S,{label:"Delete data",subLabel:"Deletes your data and logs you out of CloudSync",leading:e.React.createElement(S.Icon,{source:c.getAssetIDByName("trash")}),onPress:async function(){await Ne(),delete s.authorization,delete p.save,m(),R.showToast("Successfully deleted data",c.getAssetIDByName("trash"))}})):e.React.createElement(S,{label:"Authenticate",leading:e.React.createElement(S.Icon,{source:c.getAssetIDByName("copy")}),trailing:S.Arrow,onPress:Ae})),e.React.createElement($,{title:"Data Management",icon:c.getAssetIDByName("ic_message_edit"),padding:!0},e.React.createElement(Me,null),s.authorization&&e.React.createElement(e.React.Fragment,null,e.React.createElement(Te,null),e.React.createElement(S,{label:"Copy Data as JSON",leading:e.React.createElement(S.Icon,{source:c.getAssetIDByName("copy")}),onPress:function(){e.clipboard.setString(JSON.stringify(p.save??{},void 0,3)),R.showToast("Copied",c.getAssetIDByName("Check"))}}))))}let ce=0;function Ge(t){clearTimeout(ce),ce=setTimeout(t,1500)}const{FormRow:F}=y.Forms;function je(){const t=e.NavigationNative.useNavigation();return React.createElement(y.ErrorBoundary,null,React.createElement(F,{label:"Cloud Sync",leading:React.createElement(F.Icon,{source:c.getAssetIDByName("ic_contact_sync")}),trailing:F.Arrow,onPress:function(){return t.push("VendettaCustomPage",{title:"CloudSync",render:z})}}))}const{FormSection:He}=y.Forms,Ye=g.findByName("getScreens"),Ke=g.findByName("UserSettingsOverviewWrapper",!1),Xe=g.findByName("SettingsOverviewScreen",!1),b=g.findByProps("SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"),Je=g.findByProps("getSettingTitleConfig"),We=e.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:h.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function qe(t,n,a){const i=[],l=w.after("default",Ke,function(r,d){l();const u=k.findInReactTree(d.props.children,function(o){return o.type&&o.type.name==="UserSettingsOverview"});i.push(w.after("render",u.type.prototype,function(o,C){let{props:{children:I}}=C;const T=[e.i18n.Messages.BILLING_SETTINGS,e.i18n.Messages.PREMIUM_SETTINGS];I=k.findInReactTree(I,function(v){return v.children[1].type===He}).children;const E=I.findIndex(function(v){return T.includes(v?.props.label)});t()&&I.splice(E===-1?4:E,0,n())}))},!0);if(i.push(l),Ye&&a){const r=`VENDETTA_PLUGIN_${e.lodash.snakeCase(a.key).toUpperCase()}`;i.push(w.after("default",Xe,function(I,T){const E=T.props.sections,v=E.findIndex(function(M){return M.title==="Vendetta"});if(E[v]&&t()){const M={...E[v]};M.settings=[...M.settings,r],E[v]=M}}));const d=a.page.render,u={titleConfig:{},releationships:{},rendererConfigs:{}};u.titleConfig[r]=a.title,u.releationships[r]=null,u.rendererConfigs[r]={type:"route",icon:a.icon,screen:{route:`VendettaPlugin${e.lodash.chain(a.key).camelCase().upperFirst().value()}`,getComponent:function(){return e.React.memo(function(I){let{navigation:T}=I;const E=T.addListener("focus",function(){E(),T.setOptions(k.without(a.page,"noErrorBoundary","render"))});return e.React.createElement(e.ReactNative.View,{style:We.container},a.page.noErrorBoundary?e.React.createElement(d,null):e.React.createElement(y.ErrorBoundary,null,e.React.createElement(d,null)))})}}},i.push(w.after("getSettingTitleConfig",Je,function(I,T){return{...T,...u.titleConfig}}));const o=b.SETTING_RELATIONSHIPS;b.SETTING_RELATIONSHIPS={...o,...u.releationships};const C=b.SETTING_RENDERER_CONFIGS;b.SETTING_RENDERER_CONFIGS={...C,...u.rendererConfigs},i.push(function(){b.SETTING_RELATIONSHIPS=o,b.SETTING_RENDERER_CONFIGS=C})}return function(){return i.forEach(function(r){return r()})}}function Ze(){let t=[];return t.push(qe(function(){return s.addToSettings},function(){return React.createElement(je,null)},{key:ge.plugin.manifest.name,icon:c.getAssetIDByName("ic_search_items_24px"),title:"Cloud Sync",page:{title:"CloudSync",render:z}})),function(){return t.forEach(function(n){return n()})}}const s=de.storage,p={};f.cacheUpd=[];function m(){f.cacheUpd.forEach(function(t){return t()})}async function V(){try{p.save=await we()}catch{}m()}async function O(t,n,a,i,l,r,d){return t?new Promise(function(u){L.showConfirmationAlert({title:n,content:a,confirmText:i,cancelText:l,confirmColor:"green",isDismissable:!1,onConfirm:function(){return r?r().then(u):u()},onCancel:function(){return d?d().then(u):u()}})}):await r?.()}function G(t){return t.startsWith(fe.PROXY_PREFIX)}const j=async function(){if(!s.autoSync)return;const t=await ee();JSON.stringify(p.save)!==JSON.stringify(t)&&Ge(async function(){p.save=await Q(t),m()})};let P=[],le=!1,H=!1;const ue=function(){P.push(w.after("createMMKVBackend",A,function(t,n){P.push(w.after("set",n,function(){return j()}))}))},x=1;s.autoSync??=!1,s.addToSettings??=!0,s.pluginSettings??={},e.FluxDispatcher.subscribe("I18N_LOAD_SUCCESS",function(){le=!0,H&&ue()});var Qe={onLoad:function(){H=!0,s.authorization&&V(),["installPlugin","startPlugin","stopPlugin","removePlugin"].forEach(function(n){return P.push(w.after(n,D,function(){return j()}))}),["installTheme","selectTheme","removeTheme"].forEach(function(n){return P.push(w.after(n,B,function(){return j()}))}),le&&ue(),P.push(Ze());const t=function(n,a){return L.showConfirmationAlert({title:n,content:a,onConfirm:function(){},confirmText:"Dismiss",confirmColor:"brand",secondaryConfirmText:"Don't show again",onConfirmSecondary:function(){return s.databaseMigrate=x}})};s.databaseMigrate!==x&&window.CSmigrationStage!==x&&(window.CSmigrationStage=x,t("Cloud Sync \u2014 DB Migration Stage 1",`Hey, I'd like to quickly announce that CloudSync will be switching databases soon and your data may get ***deleted***. Make sure to keep an eye on your data for the upcoming weeks!

- nexx`))},onUnload:function(){H=!1,P.forEach(function(t){return t()})},settings:z};return f.cache=p,f.cacheUpdated=m,f.currentMigrationStage=x,f.default=Qe,f.fillCache=V,f.isPluginProxied=G,f.promptOrRun=O,f.vstorage=s,Object.defineProperty(f,"__esModule",{value:!0}),f})({},vendetta.plugin,vendetta.storage,vendetta.patcher,vendetta.plugins,vendetta.themes,vendetta.ui.toasts,vendetta.ui.assets,vendetta.ui.alerts,vendetta.metro.common,vendetta.ui.components,vendetta.metro,vendetta.ui,vendetta.utils,vendetta,vendetta.constants,vendetta.debug);
