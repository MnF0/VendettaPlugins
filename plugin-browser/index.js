(function(v,T,t,d,p,Z,S,u,I,w,A,B){"use strict";const ee=u.findByStoreName("ThemeStore"),te=u.findByProps("colors","meta"),{TextStyleSheet:ne}=u.findByProps("TextStyleSheet"),{View:ve,Text:F,Pressable:Te}=p.General;u.find(function(n){return n.render?.name==="ActionSheet"}),u.findByProps("openLazy","hideActionSheet"),u.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer"),u.findByName("Navigator"),u.findByProps("getRenderCloseButton"),u.findByProps("popModal","pushModal");function re(n){return te.meta.resolveSemanticColor(ee.theme,n)}var M;(function(n){function e(i){let{children:a,onPress:l}=i;return t.React.createElement(b,{variant:"text-md/bold",onPress:l},a)}n.Bold=e;function r(i){let{children:a,onPress:l}=i;return t.React.createElement(F,{style:{textDecorationLine:"underline"},onPress:l},a)}n.Underline=r})(M||(M={}));function b(n){let{variant:e,lineClamp:r,color:i,align:a,style:l,onPress:o,getChildren:R,children:f,liveUpdate:c}=n;const[s,h]=t.React.useReducer(function(g){return~g},0);return t.React.useEffect(function(){if(!c)return;const g=new Date().setMilliseconds(1e3);let y,N;return N=setTimeout(function(){h(),y=setInterval(h,1e3)},g-Date.now()),function(){clearTimeout(N),clearInterval(y)}},[]),t.React.createElement(F,{style:[e?ne[e]:{},i?{color:re(I.semanticColors[i])}:{},a?{textAlign:a}:{},l??{}],numberOfLines:r,onPress:o},R?.()??f)}function m(n){let{onPress:e,icon:r,style:i,destructive:a}=n;const l=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:I.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:I.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:I.semanticColors.TEXT_DANGER}});return t.React.createElement(t.ReactNative.TouchableOpacity,{onPress:e},t.React.createElement(t.ReactNative.Image,{style:[typeof i=="string"?i==="header"?l.headerStyleIcon:l.cardStyleIcon:i,a&&l.destructiveIcon].filter(function(o){return!!o}),source:r}))}let C={};function L(){return!Object.keys(C)[0]||!_.pluginCache?.[0]?[]:Object.entries(C).map(function(n){let[e,r]=n;return _.pluginCache?.includes(e)?A.plugins.plugins[e]&&A.plugins.plugins[e].manifest.hash!==r?[e,"update"]:void 0:[e,"new"]}).filter(function(n){return!!n})}function ie(){_.pluginCache=Object.keys(C)}async function k(){const n=await(await w.safeFetch($,{cache:"no-store"})).json();C=Object.fromEntries(n.map(function(e){return[`https://vd-plugins.github.io/proxy/${e.vendetta.original}`,e.hash]}))}function ae(){const n=setInterval(k,6e5);return k(),function(){return clearInterval(n)}}const{FormRow:D}=p.Forms,O=t.stylesheet.createThemedStyleSheet({card:{backgroundColor:I.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:I.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function ce(n){return t.React.createElement(t.ReactNative.View,{style:[O.card,{marginBottom:10}]},t.React.createElement(D,{style:O.header,label:n.headerLabel,leading:n.headerIcon&&t.React.createElement(D.Icon,{source:n.headerIcon})}),t.React.createElement(D,{label:n.descriptionLabel,trailing:t.React.createElement(t.ReactNative.View,{style:O.actions},n.actions?.().map(function(e){let{icon:r,onPress:i,destructive:a}=e;return t.React.createElement(m,{icon:r,onPress:i,style:"card",destructive:a??!1})}))}))}const{View:j}=p.General,V=t.stylesheet.createThemedStyleSheet({main:{marginRight:16,flexGrow:0},content:{backgroundColor:I.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND,borderRadius:16,marginLeft:8,paddingHorizontal:8}});function H(n){let{text:e,marginLeft:r}=n;return React.createElement(j,{style:[V.main,r?{marginLeft:16,marginRight:0}:{}]},React.createElement(j,{style:V.content},React.createElement(b,{variant:"eyebrow",color:"TEXT_NORMAL"},e)))}const{showUserProfile:Y}=u.findByProps("showUserProfile"),{fetchProfile:K}=u.findByProps("fetchProfile"),G=u.findByStoreName("UserStore");function se(n){let{userId:e,color:r,loadUsername:i,children:a}=n;const[l,o]=t.React.useState(!1);return t.React.useEffect(function(){return!l&&i&&(G.getUser(e)?o(G.getUser(e).username):K(e).then(function(R){return o(R.user.username)}))},[i]),t.React.createElement(b,{variant:"text-md/bold",color:r??"TEXT_NORMAL",onPress:function(){return G.getUser(e)?Y({userId:e}):K(e).then(function(){return Y({userId:e})})}},i?`@${l??"..."}`:a)}const{View:le}=p.General;function ue(n){let{item:e,index:r,changes:i}=n;const a=`https://vd-plugins.github.io/proxy/${e.vendetta.original}`,[l,o]=t.React.useState(!!A.plugins.plugins[a]),R=i.find(function(s){return s[0]===a}),f=J(e.vendetta.original),c=[];return f&&c.push({icon:d.getAssetIDByName("img_account_sync_github_white"),onPress:function(){return t.url.openURL(f)}}),t.React.createElement(ce,{index:r,headerLabel:t.React.createElement(le,{style:{flexDirection:"row"}},R&&t.React.createElement(H,{text:R[1]==="new"?"New":"Upd"}),t.React.createElement(b,{variant:"text-md/semibold",color:"HEADER_PRIMARY"},e.name,e.authors[0]&&" by ",...e.authors.map(function(s,h,g){return t.React.createElement(t.React.Fragment,null,t.React.createElement(se,{userId:s.id,color:"TEXT_LINK"},s.name),h!==g.length-1&&", ")}))),headerIcon:d.getAssetIDByName(e.vendetta.icon),descriptionLabel:e.description,actions:function(){return a.includes("plugin-browser")?[c]:l?[A.plugins.plugins[a]?.manifest.hash!==e.hash&&{icon:d.getAssetIDByName("ic_sync_24px"),onPress:function(){q(a).then(function(){S.showToast(`Successfully updated ${e.name}`,d.getAssetIDByName("ic_sync_24px")),o(!0)}).catch(function(){return S.showToast(`Failed to update ${e.name}!`,d.getAssetIDByName("Small"))})}},{icon:d.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(){try{T.removePlugin(a),S.showToast(`Successfully deleted ${e.name}`,d.getAssetIDByName("ic_message_delete")),o(!1)}catch{S.showToast(`Failed to delete ${e.name}!`,d.getAssetIDByName("Small"))}}},...c].filter(function(s){return!!s}):[{icon:d.getAssetIDByName("ic_download_24px"),onPress:async function(){T.installPlugin(a,!1).then(function(){S.showToast(`Successfully installed ${e.name}`,d.getAssetIDByName("toast_image_saved")),o(!0),T.startPlugin(a)}).catch(function(s){return S.showToast(s?.message??`Failed to install ${e.name}!`,d.getAssetIDByName("Small"))})}},...c]}})}const{showSimpleActionSheet:oe}=u.findByProps("showSimpleActionSheet"),{View:de}=p.General;var E;(function(n){n.Newest="Newest",n.Oldest="Oldest",n.Alphabetical="Alphabetical",n.ReverseAlphabetical="Reverse Alphabetical"})(E||(E={}));let z,X;function W(){const[n]=t.React.useState(L()),[e,r]=t.React.useState(E.Newest),[i,a]=t.React.useState(),[l,o]=t.React.useState("");t.React.useEffect(function(){o(""),r(E.Newest)},[]),t.React.useEffect(function(){ie()},[]);const R=t.NavigationNative.useNavigation();if(t.React.useEffect(function(){i||w.safeFetch($,{cache:"no-store"}).then(function(c){return c.json().then(function(s){return a(s)}).catch(function(){return S.showToast("Failed to parse plugins",d.getAssetIDByName("Small"))})}).catch(function(){return S.showToast("Failed to fetch plugins",d.getAssetIDByName("Small"))})},[i]),z=function(){return i&&a(void 0)},X=function(){return i&&oe({key:"CardOverflow",options:Object.values(E).map(function(c){return{label:c,onPress:function(){return r(c)}}})})},R.addListener("focus",function(){R.setOptions({title:"Plugin Browser",headerRight:function(){return t.React.createElement(de,{style:{flexDirection:"row-reverse"}},t.React.createElement(m,{onPress:function(){return z?.()},icon:d.getAssetIDByName("ic_sync_24px"),style:"header"}),t.React.createElement(m,{onPress:function(){return X?.()},icon:d.getAssetIDByName("ic_filter"),style:"header"}))}})}),!i)return t.React.createElement(t.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}});let f=i.filter(function(c){return c.name?.toLowerCase().includes(l)||c.authors?.some(function(s){return s.name?.toLowerCase().includes(l)})||c.description?.toLowerCase().includes(l)});return[E.Alphabetical,E.ReverseAlphabetical].includes(e)&&(f=f.sort(function(c,s){return c.name<s.name?-1:c.name>s.name?1:0})),[E.ReverseAlphabetical,E.Newest].includes(e)&&f.reverse(),t.React.createElement(t.ReactNative.FlatList,{ListHeaderComponent:t.React.createElement(p.Search,{style:{marginBottom:10},onChangeText:function(c){return o(c.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:f,renderItem:function(c){let{item:s,index:h}=c;return t.React.createElement(p.ErrorBoundary,null,t.React.createElement(ue,{item:s,index:h,changes:n}))},removeClippedSubviews:!0})}const{FormRow:x}=p.Forms;function fe(n){let{changes:e}=n;const r=t.NavigationNative.useNavigation();return React.createElement(p.ErrorBoundary,null,React.createElement(x,{label:React.createElement(b,{variant:"text-md/semibold",color:"HEADER_PRIMARY"},"Plugin Browser",e?React.createElement(H,{text:e.toString(),marginLeft:!0}):React.createElement(React.Fragment,null)),leading:React.createElement(x.Icon,{source:d.getAssetIDByName("ic_search_items_24px")}),trailing:x.Arrow,onPress:function(){return r.push("VendettaCustomPage",{render:W})}}))}const{FormSection:he}=p.Forms,ge=u.findByName("getScreens"),Re=u.findByName("UserSettingsOverviewWrapper",!1),pe=u.findByName("SettingsOverviewScreen",!1),P=u.findByProps("SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"),ye=u.findByProps("getSettingTitleConfig"),Ee=t.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:I.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function Se(n,e,r){const i=[],a=B.after("default",Re,function(l,o){a();const R=w.findInReactTree(o.props.children,function(f){return f.type&&f.type.name==="UserSettingsOverview"});i.push(B.after("render",R.type.prototype,function(f,c){let{props:{children:s}}=c;const h=[t.i18n.Messages.BILLING_SETTINGS,t.i18n.Messages.PREMIUM_SETTINGS];s=w.findInReactTree(s,function(y){return y.children[1].type===he}).children;const g=s.findIndex(function(y){return h.includes(y?.props.label)});n()&&s.splice(g===-1?4:g,0,e())}))},!0);if(i.push(a),ge&&r){const l=`VENDETTA_PLUGIN_${t.lodash.snakeCase(r.key).toUpperCase()}`;i.push(B.after("default",pe,function(s,h){const g=h.props.sections,y=g.findIndex(function(N){return N.title==="Vendetta"});if(g[y]&&n()){const N={...g[y]};N.settings=[...N.settings,l],g[y]=N}})),i.push(B.after("getSettingTitleConfig",ye,function(s,h){return{...h,...Object.fromEntries([[l,typeof r.title=="function"?r.title():r.title]])}}));const o=r.page.render,R=t.React.memo(function(s){let{navigation:h}=s;const g=h.addListener("focus",function(){g(),h.setOptions(w.without(r.page,"noErrorBoundary","render"))});return t.React.createElement(t.ReactNative.View,{style:Ee.container},r.page.noErrorBoundary?t.React.createElement(o,null):t.React.createElement(p.ErrorBoundary,null,t.React.createElement(o,null)))}),f=P.SETTING_RELATIONSHIPS;P.SETTING_RELATIONSHIPS={...f,...Object.fromEntries([[l,null]])};const c=P.SETTING_RENDERER_CONFIGS;P.SETTING_RENDERER_CONFIGS={...c,...Object.fromEntries([[l,{type:"route",icon:r.icon,screen:{route:`VendettaPlugin${t.lodash.chain(r.key).camelCase().upperFirst().value()}`,getComponent:function(){return R}}}]])},i.push(function(){P.SETTING_RELATIONSHIPS=f,P.SETTING_RENDERER_CONFIGS=c})}return function(){return i.forEach(function(l){return l()})}}function Ie(){let n=[];return n.push(Se(function(){return!0},function(){return React.createElement(fe,{changes:L().filter(function(e){return e[1]==="new"}).length})},{key:A.plugin.manifest.name,icon:d.getAssetIDByName("ic_search_items_24px"),title:function(){const e=L().filter(function(r){return r[1]==="new"}).length;return`Plugin Browser${e?` (+${e})`:""}`},page:{render:W}})),n.push(ae()),function(){return n.forEach(function(e){return e()})}}async function q(n){const e=n.enabled;for(let r=0;r<2;r++)e&&T.stopPlugin(n.id,!1),await T.fetchPlugin(n.id),e&&await T.startPlugin(n.id)}const $="https://vd-plugins.github.io/proxy/plugins-full.json",U={multiplePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*?)(?=\/)\/(.*)/,singlePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*)/,githubReleases:/^github\.com\/(.*?)(?=\/)\/(.*?)(?=\/)\/releases/};function J(n){const e=n.match(U.multiplePluginGitio);if(e?.[0])return`https://github.com/${e[1]}/${e[2]}/tree/master/plugins/${e[3]}`;const r=n.match(U.singlePluginGitio)??n.match(U.githubReleases);if(r?.[0])return`https://github.com/${r[1]}/${r[2]}`}const _=Z.storage;let Q;var Ne={onLoad:function(){return Q=Ie()},onUnload:function(){return Q?.()}};return v.default=Ne,v.matchGithubLink=J,v.pluginsURL=$,v.refetchPlugin=q,v.vstorage=_,Object.defineProperty(v,"__esModule",{value:!0}),v})({},vendetta.plugins,vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.plugin,vendetta.ui.toasts,vendetta.metro,vendetta.ui,vendetta.utils,vendetta,vendetta.patcher);
