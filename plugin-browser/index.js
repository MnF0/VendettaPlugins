(function(I,v,t,o,p,Z,S,f,N,P,T,C){"use strict";const{TextStyleSheet:ee}=f.findByProps("TextStyleSheet"),{View:Ne,Text:F,Pressable:Ie}=p.General;f.find(function(n){return n.render?.name==="ActionSheet"}),f.findByProps("openLazy","hideActionSheet"),f.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");function te(n){const e=f.findByProps("colors","meta"),r=f.findByStoreName("ThemeStore");return e.meta.resolveSemanticColor(r.theme,n)}var M;(function(n){function e(i){let{children:c,onPress:s}=i;return t.React.createElement(b,{variant:"text-md/bold",onPress:s},c)}n.Bold=e;function r(i){let{children:c,onPress:s}=i;return t.React.createElement(F,{style:{textDecorationLine:"underline"},onPress:s},c)}n.Underline=r})(M||(M={}));function b(n){let{variant:e,lineClamp:r,color:i,align:c,style:s,onPress:u,getChildren:g,children:d,liveUpdate:l}=n;const[a,h]=t.React.useReducer(function(E){return~E},0),R=new Date().setMilliseconds(1e3);return l&&setTimeout(function(){return h()},R-Date.now()),t.React.createElement(F,{style:[e?ee[e]:{},i?{color:te(N.semanticColors[i])}:{},c?{textAlign:c}:{},s??{}],numberOfLines:r,onPress:u},g?.()??d)}function m(n){let{onPress:e,icon:r,style:i,destructive:c}=n;const s=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:N.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:N.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:N.semanticColors.TEXT_DANGER}});return t.React.createElement(t.ReactNative.TouchableOpacity,{onPress:e},t.React.createElement(t.ReactNative.Image,{style:[typeof i=="string"?i==="header"?s.headerStyleIcon:s.cardStyleIcon:i,c&&s.destructiveIcon].filter(function(u){return!!u}),source:r}))}let _={};function L(){return!Object.keys(_)[0]||!B.pluginCache?.[0]?[]:Object.entries(_).map(function(n){let[e,r]=n;return B.pluginCache?.includes(e)?T.plugins.plugins[e]&&T.plugins.plugins[e].manifest.hash!==r?[e,"update"]:void 0:[e,"new"]}).filter(function(n){return!!n})}function ne(){B.pluginCache=Object.keys(_)}async function k(){const n=await(await P.safeFetch($,{cache:"no-store"})).json();_=Object.fromEntries(n.map(function(e){return[`https://vd-plugins.github.io/proxy/${e.vendetta.original}`,e.hash]}))}function re(){const n=setInterval(k,6e5);return k(),function(){return clearInterval(n)}}const{FormRow:O}=p.Forms,D=t.stylesheet.createThemedStyleSheet({card:{backgroundColor:N.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:N.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function ie(n){return t.React.createElement(t.ReactNative.View,{style:[D.card,{marginBottom:10}]},t.React.createElement(O,{style:D.header,label:n.headerLabel,leading:n.headerIcon&&t.React.createElement(O.Icon,{source:n.headerIcon})}),t.React.createElement(O,{label:n.descriptionLabel,trailing:t.React.createElement(t.ReactNative.View,{style:D.actions},n.actions?.().map(function(e){let{icon:r,onPress:i,destructive:c}=e;return t.React.createElement(m,{icon:r,onPress:i,style:"card",destructive:c??!1})}))}))}const{View:j}=p.General,V=t.stylesheet.createThemedStyleSheet({main:{marginRight:16,flexGrow:0},content:{backgroundColor:N.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND,borderRadius:16,marginLeft:8,paddingHorizontal:8}});function H(n){let{text:e,marginLeft:r}=n;return React.createElement(j,{style:[V.main,r?{marginLeft:16,marginRight:0}:{}]},React.createElement(j,{style:V.content},React.createElement(b,{variant:"eyebrow",color:"TEXT_NORMAL"},e)))}const{showUserProfile:X}=f.findByProps("showUserProfile"),{fetchProfile:K}=f.findByProps("fetchProfile"),G=f.findByStoreName("UserStore");function ae(n){let{userId:e,color:r,loadUsername:i,children:c}=n;const[s,u]=t.React.useState(!1);return t.React.useEffect(function(){return!s&&i&&(G.getUser(e)?u(G.getUser(e).username):K(e).then(function(g){return u(g.user.username)}))},[i]),t.React.createElement(b,{variant:"text-md/bold",color:r??"TEXT_NORMAL",onPress:function(){return G.getUser(e)?X({userId:e}):K(e).then(function(){return X({userId:e})})}},i?`@${s??"..."}`:c)}const{View:ce}=p.General;function se(n){let{item:e,index:r,changes:i}=n;const c=`https://vd-plugins.github.io/proxy/${e.vendetta.original}`,[s,u]=t.React.useState(!!T.plugins.plugins[c]),g=i.find(function(a){return a[0]===c}),d=J(e.vendetta.original),l=d&&{icon:o.getAssetIDByName("img_account_sync_github_white"),onPress:function(){return t.url.openURL(d)}};return t.React.createElement(ie,{index:r,headerLabel:t.React.createElement(ce,{style:{flexDirection:"row"}},g&&t.React.createElement(H,{text:g[1]==="new"?"New":"Upd"}),t.React.createElement(b,{variant:"text-md/semibold",color:"TEXT_NORMAL"},e.name,e.authors[0]&&" by ",...e.authors.map(function(a,h,R){return t.React.createElement(t.React.Fragment,null,t.React.createElement(ae,{userId:a.id,color:"TEXT_LINK"},a.name),h!==R.length-1&&", ")}))),headerIcon:o.getAssetIDByName(e.vendetta.icon),descriptionLabel:e.description,actions:function(){return c.includes("plugin-browser")?[l]:s?[T.plugins.plugins[c]&&T.plugins.plugins[c].manifest.hash!==e.hash&&{icon:o.getAssetIDByName("ic_sync_24px"),onPress:function(){q(c).then(function(){S.showToast(`Successfully updated ${e.name}`,o.getAssetIDByName("ic_sync_24px")),u(!0)}).catch(function(){return S.showToast(`Failed to update ${e.name}!`,o.getAssetIDByName("Small"))})}},{icon:o.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(){try{v.removePlugin(c),S.showToast(`Successfully deleted ${e.name}`,o.getAssetIDByName("ic_message_delete")),u(!1)}catch{S.showToast(`Failed to delete ${e.name}!`,o.getAssetIDByName("Small"))}}},l].filter(function(a){return!!a}):[{icon:o.getAssetIDByName("ic_download_24px"),onPress:async function(){v.installPlugin(c,!1).then(function(){S.showToast(`Successfully installed ${e.name}`,o.getAssetIDByName("toast_image_saved")),u(!0),v.startPlugin(c)}).catch(function(a){return S.showToast(a?.message??`Failed to install ${e.name}!`,o.getAssetIDByName("Small"))})}},l].filter(function(a){return!!a})}})}const{showSimpleActionSheet:le}=f.findByProps("showSimpleActionSheet"),{View:ue}=p.General;var y;(function(n){n.Newest="Newest",n.Oldest="Oldest",n.Alphabetical="Alphabetical",n.ReverseAlphabetical="Reverse Alphabetical"})(y||(y={}));let Y,z;function W(){const[n]=t.React.useState(L()),[e,r]=t.React.useState(y.Newest),[i,c]=t.React.useState(),[s,u]=t.React.useState("");t.React.useEffect(function(){u(""),r(y.Newest)},[]),t.React.useEffect(function(){ne()},[]);const g=t.NavigationNative.useNavigation();if(t.React.useEffect(function(){i||P.safeFetch($,{cache:"no-store"}).then(function(l){return l.json().then(function(a){return c(a)}).catch(function(){return S.showToast("Failed to parse plugins",o.getAssetIDByName("Small"))})}).catch(function(){return S.showToast("Failed to fetch plugins",o.getAssetIDByName("Small"))})},[i]),Y=function(){return i&&c(void 0)},z=function(){return i&&le({key:"CardOverflow",options:Object.values(y).map(function(l){return{label:l,onPress:function(){return r(l)}}})})},g.addListener("focus",function(){g.setOptions({title:"Plugin Browser",headerRight:function(){return t.React.createElement(ue,{style:{flexDirection:"row-reverse"}},t.React.createElement(m,{onPress:function(){return Y?.()},icon:o.getAssetIDByName("ic_sync_24px"),style:"header"}),t.React.createElement(m,{onPress:function(){return z?.()},icon:o.getAssetIDByName("ic_filter"),style:"header"}))}})}),!i)return t.React.createElement(t.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}});let d=i.filter(function(l){return l.name?.toLowerCase().includes(s)||l.authors?.some(function(a){return a.name?.toLowerCase().includes(s)})||l.description?.toLowerCase().includes(s)});return[y.Alphabetical,y.ReverseAlphabetical].includes(e)&&(d=d.sort(function(l,a){return l.name<a.name?-1:l.name>a.name?1:0})),[y.ReverseAlphabetical,y.Newest].includes(e)&&d.reverse(),t.React.createElement(t.ReactNative.FlatList,{ListHeaderComponent:t.React.createElement(p.Search,{style:{marginBottom:10},onChangeText:function(l){return u(l.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:d,renderItem:function(l){let{item:a,index:h}=l;return t.React.createElement(se,{item:a,index:h,changes:n})},removeClippedSubviews:!0})}const{FormRow:x}=p.Forms;function oe(n){let{changes:e}=n;const r=t.NavigationNative.useNavigation();return React.createElement(p.ErrorBoundary,null,React.createElement(x,{label:React.createElement(b,{variant:"text-md/semibold",color:"TEXT_NORMAL"},"Plugin Browser",e?React.createElement(H,{text:e.toString(),marginLeft:!0}):React.createElement(React.Fragment,null)),leading:React.createElement(x.Icon,{source:o.getAssetIDByName("ic_search_items_24px")}),trailing:x.Arrow,onPress:function(){return r.push("VendettaCustomPage",{render:W})}}))}const{FormSection:de}=p.Forms,fe=f.findByName("getScreens"),he=f.findByName("UserSettingsOverviewWrapper",!1),ge=f.findByName("SettingsOverviewScreen",!1),w=f.findByProps("SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"),Re=f.findByProps("getSettingTitleConfig"),pe=t.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:N.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function ye(n,e,r){const i=[],c=C.after("default",he,function(s,u){c();const g=P.findInReactTree(u.props.children,function(d){return d.type&&d.type.name==="UserSettingsOverview"});i.push(C.after("render",g.type.prototype,function(d,l){let{props:{children:a}}=l;const h=[t.i18n.Messages.BILLING_SETTINGS,t.i18n.Messages.PREMIUM_SETTINGS];a=P.findInReactTree(a,function(E){return E.children[1].type===de}).children;const R=a.findIndex(function(E){return h.includes(E?.props.label)});n()&&a.splice(R===-1?4:R,0,e())}))},!0);if(i.push(c),fe&&r){const s=`VENDETTA_PLUGIN_${t.lodash.snakeCase(r.key).toUpperCase()}`;i.push(C.after("default",ge,function(a,h){const R=h.props.sections,E=R.findIndex(function(A){return A.title==="Vendetta"});if(R[E]&&n()){const A={...R[E]};A.settings=[...A.settings,s],R[E]=A}})),i.push(C.after("getSettingTitleConfig",Re,function(a,h){return{...h,...Object.fromEntries([[s,typeof r.title=="function"?r.title():r.title]])}}));const u=r.page.render,g=t.React.memo(function(a){let{navigation:h}=a;const R=h.addListener("focus",function(){R(),h.setOptions(P.without(r.page,"noErrorBoundary","render"))});return t.React.createElement(t.ReactNative.View,{style:pe.container},r.page.noErrorBoundary?t.React.createElement(u,null):t.React.createElement(p.ErrorBoundary,null,t.React.createElement(u,null)))}),d=w.SETTING_RELATIONSHIPS;w.SETTING_RELATIONSHIPS={...d,...Object.fromEntries([[s,null]])};const l=w.SETTING_RENDERER_CONFIGS;w.SETTING_RENDERER_CONFIGS={...l,...Object.fromEntries([[s,{type:"route",icon:r.icon,screen:{route:`VendettaPlugin${t.lodash.chain(r.key).camelCase().upperFirst().value()}`,getComponent:function(){return g}}}]])},i.push(function(){w.SETTING_RELATIONSHIPS=d,w.SETTING_RENDERER_CONFIGS=l})}return function(){return i.forEach(function(s){return s()})}}function Ee(){let n=[];return n.push(ye(function(){return!0},function(){return React.createElement(oe,{changes:L().filter(function(e){return e[1]==="new"}).length})},{key:T.plugin.manifest.name,icon:o.getAssetIDByName("ic_search_items_24px"),title:function(){const e=L().filter(function(r){return r[1]==="new"}).length;return`Plugin Browser${e?` (+${e})`:""}`},page:{render:W}})),n.push(re()),function(){return n.forEach(function(e){return e()})}}async function q(n){const e=n.enabled;for(let r=0;r<2;r++)e&&v.stopPlugin(n.id,!1),await v.fetchPlugin(n.id),e&&await v.startPlugin(n.id)}const $="https://vd-plugins.github.io/proxy/plugins-full.json",U={multiplePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*?)(?=\/)\/(.*)/,singlePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*)/,githubReleases:/^github\.com\/(.*?)(?=\/)\/(.*?)(?=\/)\/releases/};function J(n){const e=n.match(U.multiplePluginGitio);if(e?.[0])return`https://github.com/${e[1]}/${e[2]}/tree/master/plugins/${e[3]}`;if((n.match(U.singlePluginGitio)??n.match(U.githubReleases))?.[0])return`https://github.com/${e[1]}/${e[2]}`}const B=Z.storage;let Q;var Se={onLoad:function(){return Q=Ee()},onUnload:function(){return Q?.()}};return I.default=Se,I.matchGithubLink=J,I.pluginsURL=$,I.refetchPlugin=q,I.vstorage=B,Object.defineProperty(I,"__esModule",{value:!0}),I})({},vendetta.plugins,vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.plugin,vendetta.ui.toasts,vendetta.metro,vendetta.ui,vendetta.utils,vendetta,vendetta.patcher);
