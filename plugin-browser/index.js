(function(v,T,t,o,p,Z,S,f,N,P,b,B){"use strict";const{TextStyleSheet:ee}=f.findByProps("TextStyleSheet"),{View:Ne,Text:F,Pressable:Ie}=p.General;f.find(function(n){return n.render?.name==="ActionSheet"}),f.findByProps("openLazy","hideActionSheet"),f.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");function te(n){const e=f.findByProps("colors","meta"),r=f.findByStoreName("ThemeStore");return e.meta.resolveSemanticColor(r.theme,n)}var M;(function(n){function e(i){let{children:a,onPress:l}=i;return t.React.createElement(A,{variant:"text-md/bold",onPress:l},a)}n.Bold=e;function r(i){let{children:a,onPress:l}=i;return t.React.createElement(F,{style:{textDecorationLine:"underline"},onPress:l},a)}n.Underline=r})(M||(M={}));function A(n){let{variant:e,lineClamp:r,color:i,align:a,style:l,onPress:u,getChildren:R,children:d,liveUpdate:c}=n;const[s,h]=t.React.useReducer(function(g){return~g},0);return t.React.useEffect(function(){if(!c)return;const g=new Date().setMilliseconds(1e3);let y,I;return I=setTimeout(function(){h(),y=setInterval(h,1e3)},g-Date.now()),function(){clearTimeout(I),clearInterval(y)}},[]),t.React.createElement(F,{style:[e?ee[e]:{},i?{color:te(N.semanticColors[i])}:{},a?{textAlign:a}:{},l??{}],numberOfLines:r,onPress:u},R?.()??d)}function m(n){let{onPress:e,icon:r,style:i,destructive:a}=n;const l=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:N.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:N.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:N.semanticColors.TEXT_DANGER}});return t.React.createElement(t.ReactNative.TouchableOpacity,{onPress:e},t.React.createElement(t.ReactNative.Image,{style:[typeof i=="string"?i==="header"?l.headerStyleIcon:l.cardStyleIcon:i,a&&l.destructiveIcon].filter(function(u){return!!u}),source:r}))}let _={};function L(){return!Object.keys(_)[0]||!C.pluginCache?.[0]?[]:Object.entries(_).map(function(n){let[e,r]=n;return C.pluginCache?.includes(e)?b.plugins.plugins[e]&&b.plugins.plugins[e].manifest.hash!==r?[e,"update"]:void 0:[e,"new"]}).filter(function(n){return!!n})}function ne(){C.pluginCache=Object.keys(_)}async function k(){const n=await(await P.safeFetch($,{cache:"no-store"})).json();_=Object.fromEntries(n.map(function(e){return[`https://vd-plugins.github.io/proxy/${e.vendetta.original}`,e.hash]}))}function re(){const n=setInterval(k,6e5);return k(),function(){return clearInterval(n)}}const{FormRow:O}=p.Forms,D=t.stylesheet.createThemedStyleSheet({card:{backgroundColor:N.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:N.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function ie(n){return t.React.createElement(t.ReactNative.View,{style:[D.card,{marginBottom:10}]},t.React.createElement(O,{style:D.header,label:n.headerLabel,leading:n.headerIcon&&t.React.createElement(O.Icon,{source:n.headerIcon})}),t.React.createElement(O,{label:n.descriptionLabel,trailing:t.React.createElement(t.ReactNative.View,{style:D.actions},n.actions?.().map(function(e){let{icon:r,onPress:i,destructive:a}=e;return t.React.createElement(m,{icon:r,onPress:i,style:"card",destructive:a??!1})}))}))}const{View:j}=p.General,V=t.stylesheet.createThemedStyleSheet({main:{marginRight:16,flexGrow:0},content:{backgroundColor:N.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND,borderRadius:16,marginLeft:8,paddingHorizontal:8}});function H(n){let{text:e,marginLeft:r}=n;return React.createElement(j,{style:[V.main,r?{marginLeft:16,marginRight:0}:{}]},React.createElement(j,{style:V.content},React.createElement(A,{variant:"eyebrow",color:"TEXT_NORMAL"},e)))}const{showUserProfile:X}=f.findByProps("showUserProfile"),{fetchProfile:K}=f.findByProps("fetchProfile"),G=f.findByStoreName("UserStore");function ae(n){let{userId:e,color:r,loadUsername:i,children:a}=n;const[l,u]=t.React.useState(!1);return t.React.useEffect(function(){return!l&&i&&(G.getUser(e)?u(G.getUser(e).username):K(e).then(function(R){return u(R.user.username)}))},[i]),t.React.createElement(A,{variant:"text-md/bold",color:r??"TEXT_NORMAL",onPress:function(){return G.getUser(e)?X({userId:e}):K(e).then(function(){return X({userId:e})})}},i?`@${l??"..."}`:a)}const{View:ce}=p.General;function se(n){let{item:e,index:r,changes:i}=n;const a=`https://vd-plugins.github.io/proxy/${e.vendetta.original}`,[l,u]=t.React.useState(!!b.plugins.plugins[a]),R=i.find(function(s){return s[0]===a}),d=J(e.vendetta.original),c=[];return d&&c.push({icon:o.getAssetIDByName("img_account_sync_github_white"),onPress:function(){return t.url.openURL(d)}}),t.React.createElement(ie,{index:r,headerLabel:t.React.createElement(ce,{style:{flexDirection:"row"}},R&&t.React.createElement(H,{text:R[1]==="new"?"New":"Upd"}),t.React.createElement(A,{variant:"text-md/semibold",color:"TEXT_NORMAL"},e.name,e.authors[0]&&" by ",...e.authors.map(function(s,h,g){return t.React.createElement(t.React.Fragment,null,t.React.createElement(ae,{userId:s.id,color:"TEXT_LINK"},s.name),h!==g.length-1&&", ")}))),headerIcon:o.getAssetIDByName(e.vendetta.icon),descriptionLabel:e.description,actions:function(){return a.includes("plugin-browser")?[c]:l?[b.plugins.plugins[a]?.manifest.hash!==e.hash&&{icon:o.getAssetIDByName("ic_sync_24px"),onPress:function(){q(a).then(function(){S.showToast(`Successfully updated ${e.name}`,o.getAssetIDByName("ic_sync_24px")),u(!0)}).catch(function(){return S.showToast(`Failed to update ${e.name}!`,o.getAssetIDByName("Small"))})}},{icon:o.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(){try{T.removePlugin(a),S.showToast(`Successfully deleted ${e.name}`,o.getAssetIDByName("ic_message_delete")),u(!1)}catch{S.showToast(`Failed to delete ${e.name}!`,o.getAssetIDByName("Small"))}}},...c].filter(function(s){return!!s}):[{icon:o.getAssetIDByName("ic_download_24px"),onPress:async function(){T.installPlugin(a,!1).then(function(){S.showToast(`Successfully installed ${e.name}`,o.getAssetIDByName("toast_image_saved")),u(!0),T.startPlugin(a)}).catch(function(s){return S.showToast(s?.message??`Failed to install ${e.name}!`,o.getAssetIDByName("Small"))})}},...c]}})}const{showSimpleActionSheet:le}=f.findByProps("showSimpleActionSheet"),{View:ue}=p.General;var E;(function(n){n.Newest="Newest",n.Oldest="Oldest",n.Alphabetical="Alphabetical",n.ReverseAlphabetical="Reverse Alphabetical"})(E||(E={}));let Y,z;function W(){const[n]=t.React.useState(L()),[e,r]=t.React.useState(E.Newest),[i,a]=t.React.useState(),[l,u]=t.React.useState("");t.React.useEffect(function(){u(""),r(E.Newest)},[]),t.React.useEffect(function(){ne()},[]);const R=t.NavigationNative.useNavigation();if(t.React.useEffect(function(){i||P.safeFetch($,{cache:"no-store"}).then(function(c){return c.json().then(function(s){return a(s)}).catch(function(){return S.showToast("Failed to parse plugins",o.getAssetIDByName("Small"))})}).catch(function(){return S.showToast("Failed to fetch plugins",o.getAssetIDByName("Small"))})},[i]),Y=function(){return i&&a(void 0)},z=function(){return i&&le({key:"CardOverflow",options:Object.values(E).map(function(c){return{label:c,onPress:function(){return r(c)}}})})},R.addListener("focus",function(){R.setOptions({title:"Plugin Browser",headerRight:function(){return t.React.createElement(ue,{style:{flexDirection:"row-reverse"}},t.React.createElement(m,{onPress:function(){return Y?.()},icon:o.getAssetIDByName("ic_sync_24px"),style:"header"}),t.React.createElement(m,{onPress:function(){return z?.()},icon:o.getAssetIDByName("ic_filter"),style:"header"}))}})}),!i)return t.React.createElement(t.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}});let d=i.filter(function(c){return c.name?.toLowerCase().includes(l)||c.authors?.some(function(s){return s.name?.toLowerCase().includes(l)})||c.description?.toLowerCase().includes(l)});return[E.Alphabetical,E.ReverseAlphabetical].includes(e)&&(d=d.sort(function(c,s){return c.name<s.name?-1:c.name>s.name?1:0})),[E.ReverseAlphabetical,E.Newest].includes(e)&&d.reverse(),t.React.createElement(t.ReactNative.FlatList,{ListHeaderComponent:t.React.createElement(p.Search,{style:{marginBottom:10},onChangeText:function(c){return u(c.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:d,renderItem:function(c){let{item:s,index:h}=c;return t.React.createElement(p.ErrorBoundary,null,t.React.createElement(se,{item:s,index:h,changes:n}))},removeClippedSubviews:!0})}const{FormRow:x}=p.Forms;function oe(n){let{changes:e}=n;const r=t.NavigationNative.useNavigation();return React.createElement(p.ErrorBoundary,null,React.createElement(x,{label:React.createElement(A,{variant:"text-md/semibold",color:"TEXT_NORMAL"},"Plugin Browser",e?React.createElement(H,{text:e.toString(),marginLeft:!0}):React.createElement(React.Fragment,null)),leading:React.createElement(x.Icon,{source:o.getAssetIDByName("ic_search_items_24px")}),trailing:x.Arrow,onPress:function(){return r.push("VendettaCustomPage",{render:W})}}))}const{FormSection:de}=p.Forms,fe=f.findByName("getScreens"),he=f.findByName("UserSettingsOverviewWrapper",!1),ge=f.findByName("SettingsOverviewScreen",!1),w=f.findByProps("SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"),Re=f.findByProps("getSettingTitleConfig"),pe=t.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:N.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function ye(n,e,r){const i=[],a=B.after("default",he,function(l,u){a();const R=P.findInReactTree(u.props.children,function(d){return d.type&&d.type.name==="UserSettingsOverview"});i.push(B.after("render",R.type.prototype,function(d,c){let{props:{children:s}}=c;const h=[t.i18n.Messages.BILLING_SETTINGS,t.i18n.Messages.PREMIUM_SETTINGS];s=P.findInReactTree(s,function(y){return y.children[1].type===de}).children;const g=s.findIndex(function(y){return h.includes(y?.props.label)});n()&&s.splice(g===-1?4:g,0,e())}))},!0);if(i.push(a),fe&&r){const l=`VENDETTA_PLUGIN_${t.lodash.snakeCase(r.key).toUpperCase()}`;i.push(B.after("default",ge,function(s,h){const g=h.props.sections,y=g.findIndex(function(I){return I.title==="Vendetta"});if(g[y]&&n()){const I={...g[y]};I.settings=[...I.settings,l],g[y]=I}})),i.push(B.after("getSettingTitleConfig",Re,function(s,h){return{...h,...Object.fromEntries([[l,typeof r.title=="function"?r.title():r.title]])}}));const u=r.page.render,R=t.React.memo(function(s){let{navigation:h}=s;const g=h.addListener("focus",function(){g(),h.setOptions(P.without(r.page,"noErrorBoundary","render"))});return t.React.createElement(t.ReactNative.View,{style:pe.container},r.page.noErrorBoundary?t.React.createElement(u,null):t.React.createElement(p.ErrorBoundary,null,t.React.createElement(u,null)))}),d=w.SETTING_RELATIONSHIPS;w.SETTING_RELATIONSHIPS={...d,...Object.fromEntries([[l,null]])};const c=w.SETTING_RENDERER_CONFIGS;w.SETTING_RENDERER_CONFIGS={...c,...Object.fromEntries([[l,{type:"route",icon:r.icon,screen:{route:`VendettaPlugin${t.lodash.chain(r.key).camelCase().upperFirst().value()}`,getComponent:function(){return R}}}]])},i.push(function(){w.SETTING_RELATIONSHIPS=d,w.SETTING_RENDERER_CONFIGS=c})}return function(){return i.forEach(function(l){return l()})}}function Ee(){let n=[];return n.push(ye(function(){return!0},function(){return React.createElement(oe,{changes:L().filter(function(e){return e[1]==="new"}).length})},{key:b.plugin.manifest.name,icon:o.getAssetIDByName("ic_search_items_24px"),title:function(){const e=L().filter(function(r){return r[1]==="new"}).length;return`Plugin Browser${e?` (+${e})`:""}`},page:{render:W}})),n.push(re()),function(){return n.forEach(function(e){return e()})}}async function q(n){const e=n.enabled;for(let r=0;r<2;r++)e&&T.stopPlugin(n.id,!1),await T.fetchPlugin(n.id),e&&await T.startPlugin(n.id)}const $="https://vd-plugins.github.io/proxy/plugins-full.json",U={multiplePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*?)(?=\/)\/(.*)/,singlePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*)/,githubReleases:/^github\.com\/(.*?)(?=\/)\/(.*?)(?=\/)\/releases/};function J(n){const e=n.match(U.multiplePluginGitio);if(e?.[0])return`https://github.com/${e[1]}/${e[2]}/tree/master/plugins/${e[3]}`;const r=n.match(U.singlePluginGitio)??n.match(U.githubReleases);if(r?.[0])return`https://github.com/${r[1]}/${r[2]}`}const C=Z.storage;let Q;var Se={onLoad:function(){return Q=Ee()},onUnload:function(){return Q?.()}};return v.default=Se,v.matchGithubLink=J,v.pluginsURL=$,v.refetchPlugin=q,v.vstorage=C,Object.defineProperty(v,"__esModule",{value:!0}),v})({},vendetta.plugins,vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.plugin,vendetta.ui.toasts,vendetta.metro,vendetta.ui,vendetta.utils,vendetta,vendetta.patcher);
