(function(S,I,t,o,R,d,J,N,v,P,T,m){"use strict";const{TextStyleSheet:Q}=d.findByProps("TextStyleSheet"),{View:Ne,Text:F,Pressable:ve}=R.General;d.find(function(n){return n.render?.name==="ActionSheet"}),d.findByProps("openLazy","hideActionSheet"),d.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");function Z(n){const e=d.findByProps("colors","meta"),r=d.findByStoreName("ThemeStore");return e.meta.resolveSemanticColor(r.theme,n)}var U;(function(n){function e(a){let{children:c,onPress:l}=a;return t.React.createElement(b,{variant:"text-md/bold",onPress:l},c)}n.Bold=e;function r(a){let{children:c,onPress:l}=a;return t.React.createElement(F,{style:{textDecorationLine:"underline"},onPress:l},c)}n.Underline=r})(U||(U={}));function b(n){let{variant:e,lineClamp:r,color:a,align:c,style:l,onPress:f,getChildren:p,children:u,liveUpdate:s}=n;const[i,h]=t.React.useReducer(function(E){return~E},0),g=new Date().setMilliseconds(1e3);return s&&setTimeout(function(){return h()},g-Date.now()),t.React.createElement(F,{style:[e?Q[e]:{},a?{color:Z(v.semanticColors[a])}:{},c?{textAlign:c}:{},l??{}],numberOfLines:r,onPress:f},p?.()??u)}function _(n){let{onPress:e,icon:r,style:a,destructive:c}=n;const l=t.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:v.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:v.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:v.semanticColors.TEXT_DANGER}});return t.React.createElement(t.ReactNative.TouchableOpacity,{onPress:e},t.React.createElement(t.ReactNative.Image,{style:[typeof a=="string"?a==="header"?l.headerStyleIcon:l.cardStyleIcon:a,c&&l.destructiveIcon].filter(function(f){return!!f}),source:r}))}let C={};function L(){return!Object.keys(C)[0]||!B.pluginCache?.[0]?[]:Object.entries(C).map(function(n){let[e,r]=n;return B.pluginCache?.includes(e)?T.plugins.plugins[e]&&T.plugins.plugins[e].manifest.hash!==r?[e,"update"]:void 0:[e,"new"]}).filter(function(n){return!!n})}function ee(){B.pluginCache=Object.keys(C)}async function M(){const n=await(await P.safeFetch(x,{cache:"no-store"})).json();C=Object.fromEntries(n.map(function(e){return[`https://vd-plugins.github.io/proxy/${e.vendetta.original}`,e.hash]}))}function te(){const n=setInterval(M,6e5);return M(),function(){return clearInterval(n)}}const{FormRow:O}=R.Forms,D=t.stylesheet.createThemedStyleSheet({card:{backgroundColor:v.semanticColors.BACKGROUND_SECONDARY,borderRadius:5},header:{padding:0,backgroundColor:v.semanticColors.BACKGROUND_TERTIARY,borderTopLeftRadius:5,borderTopRightRadius:5},actions:{flexDirection:"row-reverse",alignItems:"center"}});function ne(n){return t.React.createElement(t.ReactNative.View,{style:[D.card,{marginBottom:10}]},t.React.createElement(O,{style:D.header,label:n.headerLabel,leading:n.headerIcon&&t.React.createElement(O.Icon,{source:n.headerIcon})}),t.React.createElement(O,{label:n.descriptionLabel,trailing:t.React.createElement(t.ReactNative.View,{style:D.actions},n.actions?.().map(function(e){let{icon:r,onPress:a,destructive:c}=e;return t.React.createElement(_,{icon:r,onPress:a,style:"card",destructive:c??!1})}))}))}const{View:k}=R.General,j=t.stylesheet.createThemedStyleSheet({main:{marginRight:16,flexGrow:0},content:{backgroundColor:v.semanticColors.REDESIGN_BUTTON_PRIMARY_BACKGROUND,borderRadius:16,marginLeft:8,paddingHorizontal:8}});function V(n){let{text:e,marginLeft:r}=n;return React.createElement(k,{style:[j.main,r?{marginLeft:16,marginRight:0}:{}]},React.createElement(k,{style:j.content},React.createElement(b,{variant:"eyebrow",color:"TEXT_NORMAL"},e)))}const{View:re}=R.General;function ie(n){let{item:e,index:r,changes:a}=n;const c=`https://vd-plugins.github.io/proxy/${e.vendetta.original}`,[l,f]=t.React.useState(!!T.plugins.plugins[c]),p=a.find(function(i){return i[0]===c}),u=W(e.vendetta.original),s=u&&{icon:o.getAssetIDByName("img_account_sync_github_white"),onPress:function(){return t.url.openURL(u)}};return t.React.createElement(ne,{index:r,headerLabel:t.React.createElement(re,{style:{flexDirection:"row"}},p&&t.React.createElement(V,{text:p[1]==="new"?"New":"Upd"}),t.React.createElement(b,{variant:"text-md/semibold",color:"TEXT_NORMAL"},e.name,e.authors[0]&&" by ",...e.authors.map(function(i,h,g){return t.React.createElement(t.React.Fragment,null,t.React.createElement(b,{onPress:function(){return z(i.id)},variant:"text-md/bold",color:"TEXT_LINK"},i.name),h!==g.length-1&&", ")}))),headerIcon:o.getAssetIDByName(e.vendetta.icon),descriptionLabel:e.description,actions:function(){return c.includes("plugin-browser")?[s]:l?[T.plugins.plugins[c]&&T.plugins.plugins[c].manifest.hash!==e.hash&&{icon:o.getAssetIDByName("ic_sync_24px"),onPress:function(){Y(c).then(function(){N.showToast(`Successfully updated ${e.name}`,o.getAssetIDByName("ic_sync_24px")),f(!0)}).catch(function(){return N.showToast(`Failed to update ${e.name}!`,o.getAssetIDByName("Small"))})}},{icon:o.getAssetIDByName("ic_message_delete"),destructive:!0,onPress:async function(){try{I.removePlugin(c),N.showToast(`Successfully deleted ${e.name}`,o.getAssetIDByName("ic_message_delete")),f(!1)}catch{N.showToast(`Failed to delete ${e.name}!`,o.getAssetIDByName("Small"))}}},s].filter(function(i){return!!i}):[{icon:o.getAssetIDByName("ic_download_24px"),onPress:async function(){I.installPlugin(c,!1).then(function(){N.showToast(`Successfully installed ${e.name}`,o.getAssetIDByName("toast_image_saved")),f(!0),I.startPlugin(c)}).catch(function(i){return N.showToast(i?.message??`Failed to install ${e.name}!`,o.getAssetIDByName("Small"))})}},s].filter(function(i){return!!i})}})}const{showSimpleActionSheet:ae}=d.findByProps("showSimpleActionSheet"),{View:ce}=R.General;var y;(function(n){n.Newest="Newest",n.Oldest="Oldest",n.Alphabetical="Alphabetical",n.ReverseAlphabetical="Reverse Alphabetical"})(y||(y={}));let H,K;function X(){const[n]=t.React.useState(L()),[e,r]=t.React.useState(y.Newest),[a,c]=t.React.useState(),[l,f]=t.React.useState("");t.React.useEffect(function(){f(""),r(y.Newest)},[]),t.React.useEffect(function(){ee()},[]);const p=t.NavigationNative.useNavigation();if(t.React.useEffect(function(){a||P.safeFetch(x,{cache:"no-store"}).then(function(s){return s.json().then(function(i){return c(i)}).catch(function(){return N.showToast("Failed to parse plugins",o.getAssetIDByName("Small"))})}).catch(function(){return N.showToast("Failed to fetch plugins",o.getAssetIDByName("Small"))})},[a]),H=function(){return a&&c(void 0)},K=function(){return a&&ae({key:"CardOverflow",options:Object.values(y).map(function(s){return{label:s,onPress:function(){return r(s)}}})})},p.addListener("focus",function(){p.setOptions({title:"Plugin Browser",headerRight:function(){return t.React.createElement(ce,{style:{flexDirection:"row-reverse"}},t.React.createElement(_,{onPress:function(){return H?.()},icon:o.getAssetIDByName("ic_sync_24px"),style:"header"}),t.React.createElement(_,{onPress:function(){return K?.()},icon:o.getAssetIDByName("ic_filter"),style:"header"}))}})}),!a)return t.React.createElement(t.ReactNative.ActivityIndicator,{size:"large",style:{flex:1}});let u=a.filter(function(s){return s.name?.toLowerCase().includes(l)||s.authors?.some(function(i){return i.name?.toLowerCase().includes(l)})||s.description?.toLowerCase().includes(l)});return[y.Alphabetical,y.ReverseAlphabetical].includes(e)&&(u=u.sort(function(s,i){return s.name<i.name?-1:s.name>i.name?1:0})),[y.ReverseAlphabetical,y.Newest].includes(e)&&u.reverse(),t.React.createElement(t.ReactNative.FlatList,{ListHeaderComponent:t.React.createElement(R.Search,{style:{marginBottom:10},onChangeText:function(s){return f(s.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:u,renderItem:function(s){let{item:i,index:h}=s;return t.React.createElement(ie,{item:i,index:h,changes:n})},removeClippedSubviews:!0})}const{FormRow:G}=R.Forms;function se(n){let{changes:e}=n;const r=t.NavigationNative.useNavigation();return React.createElement(R.ErrorBoundary,null,React.createElement(G,{label:React.createElement(b,{variant:"text-md/semibold",color:"TEXT_NORMAL"},"Plugin Browser",e?React.createElement(V,{text:e.toString(),marginLeft:!0}):React.createElement(React.Fragment,null)),leading:React.createElement(G.Icon,{source:o.getAssetIDByName("ic_search_items_24px")}),trailing:G.Arrow,onPress:function(){return r.push("VendettaCustomPage",{render:X})}}))}const{FormSection:le}=R.Forms,oe=d.findByName("getScreens"),ue=d.findByName("UserSettingsOverviewWrapper",!1),de=d.findByName("SettingsOverviewScreen",!1),w=d.findByProps("SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"),fe=d.findByProps("getSettingTitleConfig"),he=t.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:v.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function ge(n,e,r){const a=[],c=m.after("default",ue,function(l,f){c();const p=P.findInReactTree(f.props.children,function(u){return u.type&&u.type.name==="UserSettingsOverview"});a.push(m.after("render",p.type.prototype,function(u,s){let{props:{children:i}}=s;const h=[t.i18n.Messages.BILLING_SETTINGS,t.i18n.Messages.PREMIUM_SETTINGS];i=P.findInReactTree(i,function(E){return E.children[1].type===le}).children;const g=i.findIndex(function(E){return h.includes(E?.props.label)});n()&&i.splice(g===-1?4:g,0,e())}))},!0);if(a.push(c),oe&&r){const l=`VENDETTA_PLUGIN_${t.lodash.snakeCase(r.key).toUpperCase()}`;a.push(m.after("default",de,function(i,h){const g=h.props.sections,E=g.findIndex(function(A){return A.title==="Vendetta"});if(g[E]&&n()){const A={...g[E]};A.settings=[...A.settings,l],g[E]=A}})),a.push(m.after("getSettingTitleConfig",fe,function(i,h){return{...h,...Object.fromEntries([[l,typeof r.title=="function"?r.title():r.title]])}}));const f=r.page.render,p=t.React.memo(function(i){let{navigation:h}=i;const g=h.addListener("focus",function(){g(),h.setOptions(P.without(r.page,"noErrorBoundary","render"))});return t.React.createElement(t.ReactNative.View,{style:he.container},r.page.noErrorBoundary?t.React.createElement(f,null):t.React.createElement(R.ErrorBoundary,null,t.React.createElement(f,null)))}),u=w.SETTING_RELATIONSHIPS;w.SETTING_RELATIONSHIPS={...u,...Object.fromEntries([[l,null]])};const s=w.SETTING_RENDERER_CONFIGS;w.SETTING_RENDERER_CONFIGS={...s,...Object.fromEntries([[l,{type:"route",icon:r.icon,screen:{route:`VendettaPlugin${t.lodash.chain(r.key).camelCase().upperFirst().value()}`,getComponent:function(){return p}}}]])},a.push(function(){w.SETTING_RELATIONSHIPS=u,w.SETTING_RENDERER_CONFIGS=s})}return function(){return a.forEach(function(l){return l()})}}function pe(){let n=[];return n.push(ge(function(){return!0},function(){return React.createElement(se,{changes:L().filter(function(e){return e[1]==="new"}).length})},{key:T.plugin.manifest.name,icon:o.getAssetIDByName("ic_search_items_24px"),title:function(){const e=L().filter(function(r){return r[1]==="new"}).length;return`Plugin Browser${e?` (+${e})`:""}`},page:{render:X}})),n.push(te()),function(){return n.forEach(function(e){return e()})}}const Re=d.findByStoreName("UserStore"),{showUserProfile:ye}=d.findByProps("showUserProfile"),{fetchProfile:Ee}=d.findByProps("fetchProfile");async function Y(n){const e=n.enabled;for(let r=0;r<2;r++)e&&I.stopPlugin(n.id,!1),await I.fetchPlugin(n.id),e&&await I.startPlugin(n.id)}async function z(n){Re.getUser(n)||await Ee(n),ye({userId:n})}const x="https://vd-plugins.github.io/proxy/plugins-full.json",$={multiplePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*?)(?=\/)\/(.*)/,singlePluginGitio:/^(.*?)(?=\.)\.github\.io\/(.*)/,githubReleases:/^github\.com\/(.*?)(?=\/)\/(.*?)(?=\/)\/releases/};function W(n){const e=n.match($.multiplePluginGitio);if(e?.[0])return`https://github.com/${e[1]}/${e[2]}/tree/master/plugins/${e[3]}`;if((n.match($.singlePluginGitio)??n.match($.githubReleases))?.[0])return`https://github.com/${e[1]}/${e[2]}`}const B=J.storage;let q;var Se={onLoad:function(){return q=pe()},onUnload:function(){return q?.()}};return S.default=Se,S.matchGithubLink=W,S.openProfile=z,S.pluginsURL=x,S.refetchPlugin=Y,S.vstorage=B,Object.defineProperty(S,"__esModule",{value:!0}),S})({},vendetta.plugins,vendetta.metro.common,vendetta.ui.assets,vendetta.ui.components,vendetta.metro,vendetta.plugin,vendetta.ui.toasts,vendetta.ui,vendetta.utils,vendetta,vendetta.patcher);
