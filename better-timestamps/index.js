(function(k,e,j,v,w,N,G,T,D,C){"use strict";const{TextStyleSheet:V}=T.findByProps("TextStyleSheet"),{View:S,Text:x,Pressable:z}=w.General,{FormRow:K}=w.Forms;T.find(function(a){return a.render?.name==="ActionSheet"}),T.findByProps("openLazy","hideActionSheet"),T.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");function J(a){const d=T.findByProps("colors","meta"),n=T.findByStoreName("ThemeStore");return d.meta.resolveSemanticColor(n.theme,a)}function Q(a){let{title:d,onPress:n,icon:f}=a;const r=e.stylesheet.createThemedStyleSheet({androidRipple:{color:D.semanticColors.ANDROID_RIPPLE},mainText:{fontFamily:e.constants.Fonts.PRIMARY_SEMIBOLD,fontSize:14,includeFontPadding:!1,letterSpacing:void 0,lineHeight:18,textTransform:"none",color:D.semanticColors.HEADER_SECONDARY},icon:{height:14,tintColor:D.semanticColors.HEADER_SECONDARY}}),o=n?z:S;return e.React.createElement(o,{android_ripple:r.androidRipple,disabled:!1,accessibilityRole:"button",onPress:n,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},f&&e.React.createElement(S,{style:{marginRight:4}},e.React.createElement(K.Icon,{style:r.icon,source:f,size:"small"})),e.React.createElement(x,{style:r.mainText},d))}function P(a){let{title:d,onTitlePress:n,icon:f,children:r,padding:o}=a;const t=e.stylesheet.createThemedStyleSheet({main:{backgroundColor:D.semanticColors.BACKGROUND_TERTIARY,borderRadius:16,overflow:"hidden",flex:1}});return e.React.createElement(S,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(Q,{title:d,onPress:n,icon:f}),e.React.createElement(S,{style:t.main},o?e.React.createElement(S,{style:{paddingHorizontal:16,paddingVertical:16}},r):r))}var B;(function(a){function d(f){let{children:r,onPress:o}=f;return e.React.createElement(y,{variant:"text-md/bold",onPress:o},r)}a.Bold=d;function n(f){let{children:r,onPress:o}=f;return e.React.createElement(x,{style:{textDecorationLine:"underline"},onPress:o},r)}a.Underline=n})(B||(B={}));function y(a){let{variant:d,lineClamp:n,color:f,align:r,style:o,onPress:t,getChildren:R,children:l,liveUpdate:c}=a;const[g,m]=e.React.useReducer(function(u){return~u},0);return e.React.useEffect(function(){if(!c)return;const u=new Date().setMilliseconds(1e3);let h,p;return p=setTimeout(function(){m(),h=setInterval(m,1e3)},u-Date.now()),function(){clearTimeout(p),clearInterval(h)}},[]),e.React.createElement(x,{style:[d?V[d]:{},f?{color:J(D.semanticColors[f])}:{},r?{textAlign:r}:{},o??{}],numberOfLines:n,onPress:t},R?.()??l)}const{parseTimestamp:F}=T.findByProps("parseTimestamp","unparseTimestamp"),A=e.stylesheet.createThemedStyleSheet({code:{fontFamily:e.constants.Fonts.CODE_SEMIBOLD,backgroundColor:D.semanticColors.BACKGROUND_SECONDARY},timestamp:{backgroundColor:D.semanticColors.BACKGROUND_MODIFIER_ACCENT}});function W(){const[a,d]=e.React.useState(Date.now());return e.React.useLayoutEffect(function(){return d(Date.now())},[i.time.acceptRelative]),e.React.createElement(y,{variant:"text-md/semibold",color:"TEXT_NORMAL",liveUpdate:!0,getChildren:function(){const n=new Date,f=[[4],[19,20],[4,18,2],n.getHours()<12&&[n.getHours()],[n.getHours(),n.getMinutes()],[n.getHours(),n.getMinutes(),n.getSeconds()]].filter(function(t){return!!t}),r=[];let o=-1;for(const[t,R,l]of f){o++;const c=new Date;c.setHours(t,R??0,l||0);let g=[c.getHours().toString(),R!==void 0&&c.getMinutes().toString().padStart(2,"0"),l!==void 0&&c.getSeconds().toString().padStart(2,"0")].filter(function(u){return!!u}).join(":");t<12&&(g+=" AM");const m=F(Math.floor(c.getTime()/1e3).toString(),l===0?"t":"T");r.push(i.time.requireBackticks?e.React.createElement(y,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:A.code},g):g),r.push(" \u2014 "),r.push(e.React.createElement(y,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:A.timestamp,onPress:function(){return C.showToast(m.full,v.getAssetIDByName("ic_information_24px"))}},m.formatted)),o!==f.length-1&&r.push(`
`)}if(i.time.acceptRelative){r.push(`

`);const t=[["in 20 seconds",1e3*20],["8 minutes ago",-(1e3*60*8)]];o=-1;for(const[R,l]of t){const c=a+l,g=F(Math.floor(c/1e3).toString(),"R");r.push(i.time.requireBackticks?e.React.createElement(y,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:A.code},R):R),r.push(" \u2014 "),r.push(e.React.createElement(y,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:A.timestamp,onPress:function(){return C.showToast(g.full,v.getAssetIDByName("ic_information_24px"))}},g.formatted)),o!==t.length-1&&r.push(`
`)}}return r}})}const{parseTimestamp:I}=T.findByProps("parseTimestamp","unparseTimestamp"),_=e.stylesheet.createThemedStyleSheet({code:{fontFamily:e.constants.Fonts.CODE_SEMIBOLD,backgroundColor:D.semanticColors.BACKGROUND_SECONDARY},timestamp:{backgroundColor:D.semanticColors.BACKGROUND_MODIFIER_ACCENT}});function Z(){const[a,d]=e.React.useState(Date.now());return e.React.useLayoutEffect(function(){return d(Date.now())},[i.day.acceptRelative]),e.React.createElement(y,{variant:"text-md/semibold",color:"TEXT_NORMAL",liveUpdate:!0,getChildren:function(){const n=new Date,f=[[21,11,2023],[12,5],[1,8,20],[n.getDate(),n.getMonth()-1,n.getFullYear()],[n.getDate(),n.getMonth()-1],[n.getDate(),n.getMonth()-1,n.getFullYear()-2e3]].filter(function(t){return!!t}),r=[];let o=-1;for(let[t,R,l]of f){o++;const c=new Date().getFullYear(),g=new Date;l<100&&(l+=2e3),g.setFullYear(l??c,R,t);const m=I(Math.floor(g.getTime()/1e3).toString(),"d"),u=[i.day.american?R:t,i.day.american?t:R,l].join("/");r.push(i.day.requireBackticks?e.React.createElement(y,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:_.code},u):u),r.push(" \u2014 "),r.push(e.React.createElement(y,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:_.timestamp,onPress:function(){return C.showToast(m.full,v.getAssetIDByName("ic_information_24px"))}},m.formatted)),o!==f.length-1&&r.push(`
`)}if(i.day.acceptRelative){r.push(`

`);const t=1e3*60*60*24,R=t*(365+1/4),l=[["yesterday",-t],["in 2 days",t*2],["2 centuries ago",-(R*200)],["next week",t*7]];o=-1;for(const[c,g]of l){const m=a+g,u=I(Math.floor(m/1e3).toString(),"R");r.push(i.day.requireBackticks?e.React.createElement(y,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:_.code},c):c),r.push(" \u2014 "),r.push(e.React.createElement(y,{variant:"text-md/semibold",color:"TEXT_NORMAL",style:_.timestamp,onPress:function(){return C.showToast(u.full,v.getAssetIDByName("ic_information_24px"))}},u.formatted)),o!==l.length-1&&r.push(`
`)}}return r}})}const{View:q,ScrollView:ee}=w.General,{FormSwitchRow:L,FormIcon:O}=w.Forms,{BadgableTabBar:te}=T.findByProps("BadgableTabBar");function ae(){const[a,d]=e.React.useState("time");return i.time??={acceptRelative:!1,requireBackticks:N.storage.reqBackticks??!0},i.day??={acceptRelative:!1,requireBackticks:!0,american:!1},N.storage.alwaysLong!==void 0&&delete N.storage.alwaysLong,N.storage.reqBackticks!==void 0&&delete N.storage.reqBackticks,j.useProxy(i),e.React.createElement(ee,null,e.React.createElement(q,{style:{marginHorizontal:16,marginTop:16}},e.React.createElement(te,{activeTab:a,onTabSelected:d,tabs:[{id:"day",title:"Date"},{id:"time",title:"Time"}]})),e.React.createElement(P,{title:"Info",icon:v.getAssetIDByName("ic_info_24px"),padding:!0},e.React.createElement(y,{variant:"text-md/semibold",color:"TEXT_NORMAL"},a==="time"?e.React.createElement(e.React.Fragment,null,"Send a message with a time code (in"," ",e.React.createElement(B.Bold,null,"HH:MM"),i.time.acceptRelative?", ":" or ",e.React.createElement(B.Bold,null,"HH:MM:SS"),i.time.acceptRelative&&e.React.createElement(e.React.Fragment,null," or relative")," format) and automatically turn it into a timestamp",`

`,e.React.createElement(W,null)):e.React.createElement(e.React.Fragment,null,"Send a message with a date (in"," ",e.React.createElement(B.Bold,null,i.day.american?"MM/DD":"DD/MM","/YY(YY)"),i.day.acceptRelative?", ":" or ",e.React.createElement(B.Bold,null,i.day.american?"MM/DD":"DD/MM","/MM"),i.day.acceptRelative&&e.React.createElement(e.React.Fragment,null," or relative")," format) and automatically turn it into a timestamp",`

`,e.React.createElement(Z,null)))),e.React.createElement(P,{title:"Settings",icon:v.getAssetIDByName("settings")},e.React.createElement(L,{key:`${a}_acceptRelative`,label:`Allow Relative ${a==="time"?"Time":"Date"}`,subLabel:a==="time"?"Formats relative time (in 10 seconds, 5 minutes ago)":"Formats relative date (in 2 days, 6 weeks ago)",leading:e.React.createElement(O,{source:v.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return i[a].acceptRelative=!i[a].acceptRelative},value:i[a].acceptRelative}),e.React.createElement(L,{key:`${a}_requireBackticks`,label:"Require Backticks",subLabel:`Require ${a} to be surrounded by backticks (\`)`,leading:e.React.createElement(O,{source:v.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return i[a].requireBackticks=!i[a].requireBackticks},value:i[a].requireBackticks}),a==="day"&&e.React.createElement(L,{key:`${a}_american`,label:"'Merican Dates",subLabel:"Uses MM/DD instead of DD/MM",leading:e.React.createElement(O,{source:v.getAssetIDByName("ic_message_edit")}),onValueChange:function(){return i.day.american=!i.day.american},value:i.day.american})),e.React.createElement(q,{style:{marginBottom:16}}))}function ne(a,d,n,f){const r=[["seconds?",1e3],["minutes?",6e4],["hours?",36e5]],o=365+1/4,t=[["days?",1],["weeks?",7],["months?",30.436875],["years?",o],["decades?",o*10],["century",o*100],["centuries",o*100]].map(function(s){return[s[0],s[1]*1e3*60*60*24]}),R=[...a.time?r:[],...a.date?t:[]].filter(function(s){return!!s}),l=function(s){return s?["`","`"]:["(?:\\s|\\t|^)","(?:\\s|\\t|$)"]},c=l(d.time),g=l(d.date),m=function(s){return`in (an?|[0-9]+) (${s})`},u=function(s){return`(an?|[0-9]+) (${s}) ago`},h=[a.time&&[1,`${c[0]}${m(r.map(function(s){return s[0]}).join("|"))}${c[1]}`],a.time&&[-1,`${c[0]}${u(r.map(function(s){return s[0]}).join("|"))}${c[1]}`],a.date&&[1,`${g[0]}${m(t.map(function(s){return s[0]}).join("|"))}${g[1]}`],a.date&&[-1,`${g[0]}${u(t.map(function(s){return s[0]}).join("|"))}${g[1]}`]].filter(function(s){return!!s});for(const[s,$]of h)n=n.replace(new RegExp($,"gi"),function(b,Y,ce){const U=Y.toLowerCase()==="a"?1:Number(Y);if(Number.isNaN(U))return b;const X=R.find(function(oe){return oe[0].toLowerCase().includes(ce)})?.[1];return X?f(b,X*U*s):b});const p=[["last week",-7],["yesterday",-1],["tomorrow",1],["next week",7]].map(function(s){return[`${g[0]}${s[0]}${g[1]}`,s[1]*1e3*60*60*24]}),E=[...a.date?p:[]].filter(function(s){return!!s});console.log(E);for(const[s,$]of E)n=n.replace(new RegExp(s,"gi"),function(b){return f(b,$)});return n}const re=T.findByProps("sendMessage","receiveMessage"),M=function(a){return/^\s$/.test(a)};function ie(){return G.before("sendMessage",re,function(a){const d=a[1];let n=d?.content;if(typeof n!="string"||typeof d!="object")return;const f=function(t){return t?["`","`"]:["(?:\\s|\\t|^)","(?:\\s|\\t|$)"]},r=f(i.time?.requireBackticks),o=f(i.day?.requireBackticks);if(i.time){const t={otN:"[0-9]{1,2}",tN:"[0-9]{2}",abrv:"(?: ?(AM|PM))"},R=[`(${t.otN}:${t.tN}:${t.tN})${t.abrv}?`,`(${t.otN}:${t.tN})${t.abrv}?`,`(${t.otN})${t.abrv}`].map(function(l){return new RegExp(`${r[0]}${l}${r[1]}`,"gi")});for(const l of R)n=n.replace(l,function(c,g,m){let[u,h,p]=g.split(":").map(function(s){return Number(s)});if(u<0||u>24||typeof h=="number"&&(h<0||h>60)||typeof p=="number"&&(p<0||p>60))return c;m&&(m.toLowerCase()==="pm"&&u!==12?u+=12:m.toLowerCase()==="am"&&u===12&&(u=0));const E=new Date;return E.setHours(u,h??0,p??0,0),`${M(c[0])?c[0]:""}<t:${Math.floor(E.getTime()/1e3)}:${p!==0?"T":"t"}>${M(c[c.length-1])?c[c.length-1]:""}`})}if(i.day){const t={otN:"[0-9]{1,2}",tN:"[0-9]{2}",fN:"[0-9]{4}"},R=[`(${t.otN})\\/(${t.otN})\\/(${t.fN}|${t.tN})`,`(${t.otN})\\/(${t.otN})`].map(function(l){return new RegExp(`${o[0]}${l}${o[1]}`,"gi")});for(const l of R)n=n.replace(l,function(c,g,m,u){const h=new Date().getFullYear();let[p,E,s]=[Number(g),Number(m),u?Number(u):h];if(i.day.american){const b=E;E=p,p=b}if(p<0||p>31||E<0||E>12||s<0||s>9999)return c;s<100&&(s+=2e3);const $=new Date(0);return $.setFullYear(s,E-1,p),$.setHours(12,0,0,0),`${M(c[0])?c[0]:""}<t:${Math.floor($.getTime()/1e3)}:d>${M(c[c.length-1])?c[c.length-1]:""}`})}n=ne({time:!!i.time?.acceptRelative,date:!!i.day?.acceptRelative},{time:!!i.time?.requireBackticks,date:!!i.day?.requireBackticks},n,function(t,R){return`${M(t[0])?t[0]:""}<t:${Math.floor((Date.now()+R)/1e3)}:R>${M(t[t.length-1])?t[0]:""}`}),d.content=n})}const i=N.storage;let H;var se={onLoad:function(){return H=ie()},onUnload:function(){return H?.()},settings:ae};return k.default=se,k.vstorage=i,Object.defineProperty(k,"__esModule",{value:!0}),k})({},vendetta.metro.common,vendetta.storage,vendetta.ui.assets,vendetta.ui.components,vendetta.plugin,vendetta.patcher,vendetta.metro,vendetta.ui,vendetta.ui.toasts);
